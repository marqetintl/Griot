(this["webpackJsonp@grio/client"]=this["webpackJsonp@grio/client"]||[]).push([[5],{322:function(e,t,c){},323:function(e,t,c){},324:function(e,t,c){"use strict";c.r(t),c.d(t,"ViewHeader",(function(){return D})),c.d(t,"default",(function(){return P}));var n=c(16),s=c(1),a=c(19),r=c(20),i=c(18),o=c(2),l=c(5),u=c(91),d=c(97),j=(c(322),c(4)),b=c(13),m=c(0),h=["form","doc"],f=["user","doc"],O=function(e){e.form;return Object(m.jsx)("div",{className:"dms-share-footer",children:Object(m.jsx)("div",{className:"",children:Object(m.jsx)(i.a,{primary:!0,onClick:e.closeModal,children:"Termin\xe9"})})})};function x(e){var t=e.form,c=e.doc,n=Object(j.a)(e,h),l=Object(o.useState)(""),d=Object(a.a)(l,2),f=d[0],x=d[1],v=Object(o.useState)([]),g=Object(a.a)(v,2),N=g[0],S=g[1],y=Object(o.useCallback)(Object(b.debounce)((function(e){return u.a.getStaffList(e).then((function(e){var t=e.results;S(t)}))}),400),[]);if(Object(o.useEffect)((function(){!f||f.length<3||y(f)}),[f,y]),!t||!c)return null;return Object(m.jsx)(i.j,{children:Object(m.jsx)(r.b,{context:t,id:"DocumentShareModal",className:"dms-share",children:Object(m.jsx)(i.j.Modal,{header:Object(m.jsxs)("div",{className:"dms-share-header",children:[Object(m.jsxs)("div",{className:"title",children:[Object(m.jsx)("div",{className:"btn btn-icon select",children:Object(m.jsx)(i.f.PersonPlus,{className:"icon"})}),Object(m.jsx)("h2",{children:"Partager avec des personnes"})]}),Object(m.jsx)("div",{className:"actions",children:Object(m.jsx)(i.d,{Icon:i.f.X,onClick:n.closeModal})})]}),footer:Object(m.jsx)(O,Object(s.a)(Object(s.a)({},n),{},{form:t})),children:Object(m.jsxs)("div",{className:"dms-share-select",children:[Object(m.jsx)(i.b,{floating:!0,header:Object(m.jsx)("input",{required:!0,name:"q",onChange:function(e){return x(e.target.value)},placeholder:"Ajouter des personnes",className:"miq-input mb-1"}),isOpen:f.length>2&&N.length>0,children:N.map((function(e,n){return Object(m.jsx)("div",{className:"dms-user-item",onClick:function(){return function(e){c.users.includes(e.slug)||t.setValue("user",e)}(e)},role:"button",children:Object(m.jsx)(_,{user:e,form:t})},"".concat(e.slug,"-").concat(n))}))}),Object(m.jsx)("div",{className:"dms-share-users my-2",children:c.users_data.map((function(e){return Object(m.jsxs)("div",{className:"my-1 d-flex align-items-center justify-content-between",children:[Object(m.jsx)(_,{user:e,form:t}),Object(m.jsxs)("div",{className:"d-flex align-items-center",children:[Object(m.jsx)(p,{user:e,doc:c,form:t,setDoc:n.setDoc,className:"me-1"}),Object(m.jsx)(i.d,{Icon:i.f.X,onClick:function(){u.a.patchUser(c.slug,{action:"remove",users:[e.slug]}).then((function(e){n.setDoc(Object(s.a)(Object(s.a)({},c),e))})).catch((function(e){console.log(e)}))},title:"Supprimer cet utilisateur"})]})]},e.slug)}))})]})})})})}var p=function(e){var t=e.user,c=e.doc,n=Object(j.a)(e,f),r=Object(o.useState)(t.permission||"VIEW"),i=Object(a.a)(r,2),l=i[0],d=i[1],b=Object.values(c.permissions);return Object(m.jsx)("select",{value:l,className:"miq-select me-1",onChange:function(e){var a=e.target.value;d(a),u.a.patchUserPermission(c.slug,t.slug,a).then((function(e){return n.setDoc(Object(s.a)(Object(s.a)({},c),e))}))},children:b.map((function(e){return Object(m.jsx)("option",{value:e.value,children:e.label},e.name)}))})};var v=["form","doc"],g=function(e){var t=e.addUser;return Object(m.jsx)("div",{className:"dms-share-footer",children:Object(m.jsx)("div",{className:"",children:Object(m.jsx)(i.a,{onClick:t,children:"Envoyer"})})})};function N(e){var t=e.form,c=e.doc,n=Object(j.a)(e,v),a=t.values.user;if(!t)return null;return Object(m.jsx)(i.j,{children:Object(m.jsx)(r.b,{context:t,id:"DocumentShareModal",className:"dms-share",children:Object(m.jsx)(i.j.Modal,{header:Object(m.jsxs)("div",{className:"dms-share-header",children:[Object(m.jsxs)("div",{className:"title",children:[Object(m.jsx)("div",{children:Object(m.jsx)(i.d,{Icon:i.f.ArrowLeft,onClick:function(){return t.setValue("user","")},title:"Retourner derriere",className:"add"})}),Object(m.jsx)("h2",{children:"Partager avec des personnes"})]}),Object(m.jsx)("div",{className:"actions"})]}),footer:Object(m.jsx)(g,Object(s.a)(Object(s.a)({},n),{},{addUser:function(){var e=t.values.user.slug;e!==c.uploaded_by.slug&&u.a.patchUser(c.slug,{action:"add",users:[e]}).then((function(e){n.setDoc(Object(s.a)(Object(s.a)({},c),e)),t.setValue("user",null)})).catch((function(e){console.log(e)}))}})),children:Object(m.jsxs)("div",{className:"dms-share-add",children:[Object(m.jsx)("div",{className:"",children:Object(m.jsx)(_,{user:a})}),Object(m.jsxs)("div",{className:"add-form mt-2",children:[Object(m.jsx)(r.b.CheckboxInput,{name:"sendNotif",checked:t.values.sendNotif,label:"Envoyer une notification"}),Object(m.jsx)(r.b.TextArea,{name:"message",placeholder:"Message",maxLength:200,rows:4,className:"my-1"})]})]})})})})}c(323);var S=["user","form"];function y(e){var t=Object(r.c)({q:"",user:null,sendNotif:!0,message:""});if(!e.isOpen)return null;var c=function(){return e.setOpen(!1)};return t.values.user?Object(m.jsx)(N,Object(s.a)(Object(s.a)({},e),{},{form:t,closeModal:c})):Object(m.jsx)(x,Object(s.a)(Object(s.a)({},e),{},{form:t,closeModal:c}))}var _=function(e){var t=e.user;e.form,Object(j.a)(e,S);return Object(m.jsxs)("div",{className:"d-flex align-items-center",children:[Object(m.jsx)("div",{className:"",children:Object(m.jsx)(i.g,{})}),Object(m.jsxs)("div",{className:"ms-1",children:[Object(m.jsx)("div",{className:"",children:t.name}),Object(m.jsxs)("div",{className:"",children:["@",t.username]})]})]})},k=c(3),C=["onSuccess"];function I(e){var t=e.onSuccess,c=Object(j.a)(e,C),n=Object(o.createRef)();return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(i.d,Object(s.a)(Object(s.a)({Icon:i.f.PaperClip,label:"Joindre",title:"Joindre des fichiers \xe0 ce document"},c),{},{onClick:function(){return n.click()}})),Object(m.jsx)(i.c,{onChange:function(e){Array.from(e.target.files).forEach((function(e){u.a.postFile(e).then((function(e){t&&t(e)})).catch((function(e){console.log(e)}))}))},ref:function(e){return n=e}})]})}var A=["docSlug"];function w(e){var t=e.docSlug,c=Object(j.a)(e,A),n=c.form,a=void 0===n?Object(k.j)("form"):n,o=c.doc,l=c.handleTextInputSave;return Object(m.jsxs)(r.a,{value:a,children:[Object(m.jsxs)("div",{className:"d-flex align-items-center justify-content-between my-2",children:[Object(m.jsxs)("div",{className:"d-flex",children:[Object(m.jsx)(i.d,{Icon:i.f.Trash,label:"Supprimer",title:"Supprimer ce document",onClick:function(){return u.a.delete(t).then((function(e){c.history.push("/grio/documents/")})).catch((function(e){}))},className:"me-1",disabled:o.is_read_only}),Object(m.jsx)(i.d,{Icon:i.f.Archive,onClick:function(e){var n="".concat(Object(k.c)(c.match.url),"view/");if("ARCHIVED"===o.status)return c.history.push(n);u.a.archive(t).then((function(){c.history.push(n)})).catch((function(e){}))},label:"Archiver",title:"Archiver ce document. Un document archiv\xe9 ne peut plus \xeatre modifi\xe9",disabled:o.is_read_only})]}),Object(m.jsx)("div",{className:"actions",children:Object(m.jsx)(I,{onSuccess:function(e){var n=e.slug;u.a.patchFile(t,{action:"add",files:[n]}).then((function(e){console.log(e),c.setDoc(Object(s.a)(Object(s.a)({},o),e))})).catch((function(e){}))},disabled:o.is_read_only,className:"p-1"})})]}),Object(m.jsxs)("div",{className:"d-grid grid-lg-12 mb-2",children:[Object(m.jsx)(r.b.Label,{value:"Reference",className:"span-12 mb-1"}),Object(m.jsx)(r.b.TextInput,{name:"reference",onSave:l,autoComplete:"off",className:"span-12 span-md-4",placeholder:"Ajouter une reference ...",disabled:o.is_read_only})]}),Object(m.jsxs)("div",{className:"d-grid grid-1 grid-xl-12 mb-2",children:[Object(m.jsx)(r.b.Label,{value:"Description",className:"span-12 mb-1"}),Object(m.jsx)("div",{className:"span-lg-8",children:Object(m.jsx)(r.b.TextAreaX,{name:"description",onSave:l,placeholder:"Ajouter une description ...",disabled:o.is_read_only})})]})]})}var D=function(e){var t=e.doc,c=Object(o.useState)(!1),n=Object(a.a)(c,2),l=n[0],u=n[1];return Object(m.jsxs)("div",{className:"document-update-header my-2",children:[Object(m.jsx)("div",{className:"pe-1",children:Object(m.jsx)(i.e,{to:e.match.path.replace(":docSlug/",""),Icon:i.f.ArrowLeft,title:"Retourner en arriere"})}),Object(m.jsx)("div",{className:"flex-1",children:Object(m.jsx)(r.b.TextInput,{required:!0,name:"title",onSave:e.handleTextInputSave,disabled:t.is_read_only,autoComplete:"off",tabIndex:0,"aria-label":"Renommer ce document",title:"Renommer ce document","data-tooltip":"Renommer ce document"})}),Object(m.jsxs)("div",{className:"ps-1",children:[Object(m.jsx)(i.d,{primary:!0,onClick:function(){return u(!0)},disabled:t.is_read_only,Icon:i.f.Share,label:"Partager",title:"Partager ce document avec des personnes"}),!t.is_read_only&&l&&Object(m.jsx)(y,Object(s.a)(Object(s.a)({},e),{},{setOpen:u,isOpen:l}))]})]})};function P(e){var t,c=e.match.params.docSlug,i=Object(o.useState)(null),j=Object(a.a)(i,2),b=j[0],h=j[1],f=Object(o.useState)(null),O=Object(a.a)(f,2),x=O[0],p=O[1],v=Object(r.c)({title:"",reference:"",description:""}),g=v.setValues;if(Object(o.useEffect)((function(){u.a.get(c).then((function(e){h(e),g({title:e.title||"",reference:e.reference||"",description:e.description||""})})).catch((function(e){e.response&&404===e.response.status?p("notfound"):p("error")}))}),[c,g]),x)return Object(m.jsx)("div",{children:Object(m.jsx)("h1",{children:"Ce document n'existe pas"})});if(!b||!b.slug)return null;var N=function(e){var t=e.name,s=e.value;b&&!b.is_read_only&&u.a.patch(c,Object(n.a)({},t,s),Object(n.a)({},t,b[t])).then((function(e){})).catch((function(e){}))};return Object(m.jsx)(r.b,{context:v,className:"document-update-form",children:Object(m.jsxs)(l.f,{className:"document-update-view miq-container-fluid",children:[Object(m.jsx)(D,Object(s.a)(Object(s.a)({},e),{},{doc:b,setDoc:h,handleTextInputSave:N})),Object(m.jsx)(w,Object(s.a)(Object(s.a)({},e),(t={docSlug:c,doc:b,setDoc:h},Object(n.a)(t,"docSlug",c),Object(n.a)(t,"form",v),Object(n.a)(t,"handleTextInputSave",N),t))),Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"d-flex align-items-center justify-content-between",children:Object(m.jsx)("h4",{children:"Fichiers"})}),Object(m.jsx)(d.a,{items:b.files_data})]})]})})}},91:function(e,t,c){"use strict";c.d(t,"a",(function(){return a}));var n=c(5),s=c(3),a={path:"documents/",list:function(e){return Object(s.h)(n.a,this.path,e)},listPage:function(e){return Object(s.h)(n.a,e)},get:function(e,t){return Object(s.h)(n.a,"".concat(this.path).concat(e,"/"),t)},post:function(e){return n.j.post("".concat(this.path),e)},patch:function(e,t,c){return n.j.patch("".concat(this.path).concat(e,"/"),t,c)},archive:function(e){return n.j.get("".concat(this.path).concat(e,"/archive/"))},delete:function(e){return n.j.delete("".concat(this.path).concat(e,"/"))},postFile:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:isRequired("file"),t=e.name;if(t.length>=100)return Promise.reject("File name is too long");var c=new FormData;return c.append("src",e,t),n.j.post("docufiles/",c,{headers:{"content-type":"multipart/form-data"}})},patchFile:function(e,t){return Object.keys(t).includes("action")?n.j.post("".concat(this.path).concat(e,"/files/"),t):Promise.reject("Action required")},patchUserPermission:function(e,t,c){return n.j.post("".concat(this.path).concat(e,"/permission/"),{user_slug:t,permission:c})},getStaffList:function(e){return n.j.get("search-staff/",{q:e})},patchUser:function(e,t){return Object.keys(t).includes("action")?n.j.post("".concat(this.path).concat(e,"/users/"),t):Promise.reject("Action required")}}},97:function(e,t,c){"use strict";c.d(t,"a",(function(){return l}));var n=c(4),s=c(1),a=c(18),r=(c(98),c(0)),i=["items"],o=function(e){switch(e.ext){case".jpg":case".jpeg":case".png":return Object(r.jsx)(a.h,Object(s.a)({},e));default:var t=a.f.getFileIcon(e.ext);return Object(r.jsx)(t,{className:"icon mb-1"})}};function l(e){var t=e.items,c=void 0===t?[]:t;Object(n.a)(e,i);return Object(r.jsx)("div",{className:"docufile-grid",children:c.map((function(e){return Object(r.jsxs)(a.a,{title:e.name,className:"docufile-btn",children:[o(e),Object(r.jsxs)("div",{className:"text-center",children:[Object(r.jsx)("span",{className:"label d-block",children:e.name_truncated}),Object(r.jsx)("span",{className:"size d-block",children:e.size})]})]},e.slug)}))})}},98:function(e,t,c){}}]);
//# sourceMappingURL=5.b6751fdb.chunk.js.map