{"version":3,"sources":["../../../../../packages/miq-dms/src/DocumentReadOnlyView.jsx","../../../../../packages/miq-dms/src/utils.jsx","../../../../../packages/miq-dms/src/DocuFileGrid.jsx"],"names":["DocumentReadOnlyView","props","docSlug","match","params","useState","doc","setDoc","setError","useEffect","docServices","get","then","data","catch","err","id","className","title","actions","users_data","map","user","UserAvatar","slug","style","fontWeight","reference","formatDate","created","month","day","year","description","items","files_data","initials","path","list","getService","API","this","listPage","url","post","values","services","patch","oldValues","archive","delete","postFile","file","isRequired","name","length","Promise","reject","fd","FormData","append","headers","patchFile","Object","keys","includes","patchUserPermission","user_slug","permission","getStaffList","q","patchUser","getIcon","ext","Icon","Icons","getFileIcon","DocuFileGrid","name_truncated","size"],"mappings":"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","file":"static/js/6.e7548eb9.chunk.js","sourcesContent":["import { AdminView } from \"@miq/admin\";\nimport { useEffect, useState } from \"react\";\nimport DocuFileGrid from \"./DocuFileGrid\";\nimport { formatDate } from \"@miq/utils\";\nimport { docServices } from \"./utils\";\n\nexport default function DocumentReadOnlyView(props) {\n    const { docSlug } = props.match.params;\n\n    const [doc, setDoc] = useState(null);\n    const [error, setError] = useState(null);\n\n    useEffect(() => {\n        docServices\n            .get(docSlug)\n            .then((data) => {\n                setDoc(data);\n            })\n            .catch((err) => setError(\"Error\"));\n    }, []);\n\n    if (!doc) return null;\n\n    return (\n        <AdminView\n            id=\"DocumentReadOnlyView\"\n            className=\"document-readonly-view\"\n            title={doc.title}\n            actions={\n                <>\n                    <div className=\"miq-user-avatar-group\">\n                        <div className=\"miq-user-avatar count\">+6</div>\n\n                        {doc.users_data.map((user) => (\n                            <UserAvatar user={user} key={user.slug} />\n                        ))}\n                    </div>\n                </>\n            }\n        >\n            <div className=\"d-flex justify-content-between mb-2\">\n                <div className=\"\">\n                    Reference <span style={{ fontWeight: \"600\" }}>{doc.reference}</span>\n                </div>\n\n                <div className=\"text-muted fs-sm\">\n                    {formatDate(doc.created, { month: \"long\", day: \"numeric\", year: \"numeric\" }, \"fr\")}\n                </div>\n            </div>\n\n            <div className=\"mb-4\">{doc.description}</div>\n\n            {/*  */}\n            <DocuFileGrid items={doc.files_data} />\n\n            <div className=\"\">Voir les commentaires</div>\n        </AdminView>\n    );\n}\n\nconst UserAvatar = ({ user, ...props }) => {\n    if (!user) return null;\n    return <div className=\"miq-user-avatar\">{user.initials}</div>;\n};\n","import { API, services } from \"@miq/admin\";\nimport { getService } from \"@miq/utils\";\n\nexport const docServices = {\n    path: \"documents/\",\n\n    /**\n     * DOCUMENT\n     */\n\n    list(params) {\n        return getService(API, this.path, params);\n    },\n    listPage(url) {\n        return getService(API, url);\n    },\n    get(docSlug, params) {\n        return getService(API, `${this.path}${docSlug}/`, params);\n    },\n    post(values) {\n        return services.post(`${this.path}`, values);\n    },\n    patch(docSlug, values, oldValues) {\n        return services.patch(`${this.path}${docSlug}/`, values, oldValues);\n    },\n    archive(docSlug) {\n        return services.get(`${this.path}${docSlug}/archive/`);\n    },\n    delete(docSlug) {\n        return services.delete(`${this.path}${docSlug}/`);\n    },\n\n    /**\n     * DOCUFILE\n     */\n\n    postFile(file = isRequired(\"file\")) {\n        let name = file.name;\n        if (name.length >= 100) {\n            return Promise.reject(\"File name is too long\");\n        }\n\n        const fd = new FormData();\n        fd.append(\"src\", file, name);\n\n        return services.post(`docufiles/`, fd, {\n            headers: { \"content-type\": \"multipart/form-data\" },\n        });\n    },\n\n    patchFile(docSlug, values) {\n        if (!Object.keys(values).includes(\"action\")) {\n            return Promise.reject(\"Action required\");\n        }\n\n        return services.post(`${this.path}${docSlug}/files/`, values);\n    },\n\n    /**\n     * USER\n     */\n\n    patchUserPermission(docSlug, user_slug, permission) {\n        return services.post(`${this.path}${docSlug}/permission/`, { user_slug, permission });\n    },\n\n    getStaffList(q) {\n        return services.get(\"search-staff/\", { q });\n    },\n\n    patchUser(docSlug, values) {\n        if (!Object.keys(values).includes(\"action\")) {\n            return Promise.reject(\"Action required\");\n        }\n\n        return services.post(`${this.path}${docSlug}/users/`, values);\n    },\n};\n","import { Icons, Button, ImgSquare, IconNavLink } from \"@miq/components\";\n\nimport \"./docufile-grid.scss\";\n\nconst getIcon = (file) => {\n    switch (file.ext) {\n        case \".jpg\":\n        case \".jpeg\":\n        case \".png\":\n            return <ImgSquare {...file} />;\n\n        default:\n            const Icon = Icons.getFileIcon(file.ext);\n            return <Icon className=\"icon mb-1\" />;\n    }\n};\n\nexport default function DocuFileGrid({ items = [], ...props }) {\n    return (\n        <div className=\"docufile-grid\">\n            {items.map((file) => {\n                return (\n                    <Button title={file.name} className=\"docufile-btn\" key={file.slug}>\n                        {getIcon(file)}\n\n                        <div className=\"text-center\">\n                            <span className=\"label d-block\">{file.name_truncated}</span>\n                            <span className=\"size d-block\">{file.size}</span>\n                        </div>\n                    </Button>\n                );\n            })}\n        </div>\n    );\n}\n"],"sourceRoot":""}