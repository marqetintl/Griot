(this["webpackJsonp@grio/client"]=this["webpackJsonp@grio/client"]||[]).push([[5],{319:function(e,t,c){},320:function(e,t,c){},322:function(e,t,c){"use strict";c.r(t),c.d(t,"ViewHeader",(function(){return V})),c.d(t,"default",(function(){return P}));var a=c(33),n=c(2),s=c(15),r=c(89),i=c(19),o=c(1),l=c(88),j=(c(319),c(3)),u=c(17),d=c(0),b=["form","doc"],O=function(e){return Object(d.jsxs)("div",{className:"dms-share-header",children:[Object(d.jsxs)("div",{className:"title",children:[Object(d.jsx)("div",{className:"icon-wrapper",children:Object(d.jsx)(i.e.PersonPlus,{})}),Object(d.jsx)("h2",{children:"Partager avec des personnes"})]}),Object(d.jsx)("div",{className:"actions",children:Object(d.jsx)(i.c,{Icon:i.e.X})})]})},h=function(e){e.form;return Object(d.jsx)("div",{className:"dms-share-footer",children:Object(d.jsx)("div",{className:"",children:Object(d.jsx)(i.a,{primary:!0,onClick:e.closeModal,children:"Termin\xe9"})})})};function m(e){var t=e.form,c=e.doc,a=Object(j.a)(e,b),m=Object(o.useState)(""),f=Object(s.a)(m,2),x=f[0],v=f[1],p=Object(o.useState)([]),g=Object(s.a)(p,2),y=g[0],C=g[1],k=Object(o.useCallback)(Object(u.debounce)((function(e){return l.a.getStaffList(e).then((function(e){var t=e.results;C(t)}))}),400),[]);if(Object(o.useEffect)((function(){!x||x.length<3||k(x)}),[x,k]),!t||!c)return null;return Object(d.jsx)(i.g,{children:Object(d.jsx)(r.b,{context:t,id:"DocumentShareModal",className:"dms-share",children:Object(d.jsx)(i.g.Modal,{header:Object(d.jsx)(O,Object(n.a)(Object(n.a)({},a),{},{form:t})),footer:Object(d.jsx)(h,Object(n.a)(Object(n.a)({},a),{},{form:t})),children:Object(d.jsxs)("div",{className:"dms-share-select",children:[Object(d.jsx)(i.b,{floating:!0,header:Object(d.jsx)("input",{required:!0,name:"q",onChange:function(e){return v(e.target.value)},placeholder:"Ajouter des personnes",className:"miq-input mb-1"}),isOpen:x.length>2&&y.length>0,children:y.map((function(e,a){return Object(d.jsx)("div",{className:"dms-user-item",onClick:function(){return function(e){c.users.includes(e.slug)||t.setValue("user",e)}(e)},role:"button",children:Object(d.jsx)(N,{user:e,form:t})},"".concat(e.slug,"-").concat(a))}))}),Object(d.jsx)("div",{className:"dms-share-users my-2",children:c.users_data.map((function(e){return Object(d.jsxs)("div",{className:"my-1",children:[Object(d.jsx)(N,{user:e,form:t}),e.permission]},e.slug)}))})]})})})})}var f=["form","doc"],x=function(e){e.form;var t=e.addUser;return Object(d.jsx)("div",{className:"dms-share-footer",children:Object(d.jsx)("div",{className:"",children:Object(d.jsx)(i.a,{onClick:t,children:"Envoyer"})})})};function v(e){var t=e.form,c=e.doc,a=Object(j.a)(e,f),s=t.values.user;if(!t)return null;return Object(d.jsx)(i.g,{children:Object(d.jsx)(r.b,{context:t,id:"DocumentShareModal",className:"dms-share",children:Object(d.jsx)(i.g.Modal,{header:Object(d.jsxs)("div",{className:"dms-share-header",children:[Object(d.jsxs)("div",{className:"title",children:[Object(d.jsx)("div",{className:"icon",children:Object(d.jsx)(i.c,{Icon:i.e.ArrowLeft,onClick:function(){return t.setValue("user","")},title:"Retourner derriere"})}),Object(d.jsx)("h2",{children:"Partager avec des personnes"})]}),Object(d.jsx)("div",{className:"actions"})]}),footer:Object(d.jsx)(x,Object(n.a)(Object(n.a)({},a),{},{addUser:function(){var e=t.values.user.slug;e!==c.uploaded_by.slug&&l.a.patchUser(c.slug,{action:"add",users:[e]}).then((function(e){console.log(e),a.setDoc(Object(n.a)(Object(n.a)({},c),e)),t.setValue("user",null)})).catch((function(e){console.log(e)}))}})),children:Object(d.jsxs)("div",{className:"dms-share-add",children:[Object(d.jsx)("div",{className:"",children:Object(d.jsx)(N,{user:s})}),Object(d.jsxs)("div",{className:"add-form mt-2",children:[Object(d.jsx)(r.b.CheckboxInput,{name:"sendNotif",checked:t.values.sendNotif,label:"Envoyer une notification"}),Object(d.jsx)(r.b.TextArea,{name:"message",placeholder:"Message",maxLength:200,rows:4,className:"my-1"})]})]})})})})}c(320);var p=["user","form"];function g(e){var t=Object(r.c)({q:"",user:null,sendNotif:!0,message:""});if(!e.isOpen)return null;var c=function(){return e.setOpen(!1)};return t.values.user?Object(d.jsx)(v,Object(n.a)(Object(n.a)({},e),{},{form:t,closeModal:c})):Object(d.jsx)(m,Object(n.a)(Object(n.a)({},e),{},{form:t,closeModal:c}))}var N=function(e){var t=e.user;e.form,Object(j.a)(e,p);return Object(d.jsxs)("div",{className:"d-flex align-items-center",children:[Object(d.jsx)("div",{className:"",children:Object(d.jsx)(i.f,{})}),Object(d.jsxs)("div",{className:"ms-1",children:[Object(d.jsx)("div",{className:"",children:t.name}),Object(d.jsxs)("div",{className:"",children:["@",t.username]})]})]})},y=c(7),C=c(4),k=(c(18),c(22)),S=c.n(k),w=["onSuccess"],A=function(e){var t=e.onSuccess,c=Object(j.a)(e,w),a=Object(o.createRef)();return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(i.c,Object(n.a)(Object(n.a)({Icon:R,label:"Joindre"},c),{},{onClick:function(){return a.click()}})),Object(d.jsx)(q,{onChange:function(e){console.log(e.target.files),Array.from(e.target.files).forEach((function(e){l.a.postFile(e).then((function(e){t&&t(e)})).catch((function(e){console.log(e)}))}))},ref:function(e){return a=e}})]})},I=["image/*",".pdf",".md",".doc",".docx","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].join(","),q=Object(o.forwardRef)((function(e,t){return S.a.createPortal(Object(d.jsx)("input",Object(n.a)(Object(n.a)({name:"files",accept:I},e),{},{type:"file",style:Object(n.a)(Object(n.a)({},e.style),{},{display:"none"}),ref:t})),document.body)})),R=function(e){return Object(d.jsx)("svg",Object(n.a)(Object(n.a)({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},e),{},{children:Object(d.jsx)("path",{d:"M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z"})}))},T=["docSlug"];function F(e){var t=e.docSlug,c=Object(j.a)(e,T),s=c.form,o=void 0===s?Object(C.i)("form"):s,u=c.doc,b=c.setDoc,O="ARCHIVED"===u.status,h=function(e){var c=e.name,n=e.value;l.a.patch(t,Object(a.a)({},c,n),Object(a.a)({},c,u[c])).then((function(e){console.log(e)})).catch((function(e){}))};return Object(d.jsx)(r.b,{context:o,className:"document-update-form",children:Object(d.jsxs)(y.f,{className:"document-update-view",children:[Object(d.jsx)(V,Object(n.a)(Object(n.a)({},c),{},{doc:u,setDoc:b,handleTextInputSave:h,isReadOnly:O})),Object(d.jsxs)("div",{className:"",children:["Supprimer | Archiver | Commenter | ",Object(d.jsx)(A,{onSuccess:function(e){var c=e.slug;l.a.patchFile(t,{action:"add",files:[c]}).then((function(e){console.log(e)})).catch((function(e){}))},disabled:O})]}),Object(d.jsxs)("div",{className:"field",children:[Object(d.jsx)(r.b.Label,{value:"Reference"}),Object(d.jsx)(r.b.TextInput,{name:"reference",onSave:h,autoComplete:"off",placeholder:"Ajouter une reference ...",disabled:O})]}),Object(d.jsxs)("div",{className:"field",children:[Object(d.jsx)(r.b.Label,{value:"Description"}),Object(d.jsx)(r.b.TextAreaX,{name:"description",onSave:h,placeholder:"Ajouter une description ...",disabled:O})]}),Object(d.jsxs)("div",{children:[Object(d.jsx)("div",{className:"d-flex align-items-center justify-content-between",children:Object(d.jsx)("h4",{children:"Fichiers"})}),Object(d.jsx)(i.h,{headers:["","Title","Ajout\xe9 par","Date","Taille"],children:u.files_data&&u.files_data.map((function(e){var t=i.e.getFileIcon(e.ext);return Object(d.jsxs)("tr",{children:[Object(d.jsx)("td",{children:Object(d.jsx)(t,{ext:e.ext})}),Object(d.jsx)("td",{children:e.name_truncated}),Object(d.jsx)("td",{children:e.user.name}),Object(d.jsx)("td",{children:e.created}),Object(d.jsx)("td",{children:e.size})]},e.slug)}))})]})]})})}var V=function(e){var t=e.isReadOnly,c=Object(o.useState)(!1),a=Object(s.a)(c,2),l=a[0],j=a[1];return Object(d.jsxs)("div",{className:"document-update-header my-2",children:[Object(d.jsx)("div",{className:"pe-2",children:Object(d.jsx)(i.d,{to:e.match.path.replace(":docSlug/",""),Icon:i.e.ArrowLeft,title:"Retourner en arriere"})}),Object(d.jsx)("div",{className:"flex-1",children:Object(d.jsx)(r.b.TextInput,{required:!0,name:"title",onSave:e.handleTextInputSave,disabled:t,autoComplete:"off",tabIndex:0,"aria-label":"Renommer ce document",title:"Renommer ce document","data-tooltip":"Renommer ce document"})}),Object(d.jsxs)("div",{className:"ps-2",children:[Object(d.jsx)(i.c,{primary:!0,disabled:t,Icon:i.e.Share,label:"Partager",title:"Partager ce document avec des personnes",onClick:function(){return j(!0)}}),!t&&l&&Object(d.jsx)(g,Object(n.a)(Object(n.a)({},e),{},{setOpen:j,isOpen:l}))]})]})};function P(e){var t,c=e.match.params.docSlug,i=Object(o.useState)(null),j=Object(s.a)(i,2),u=j[0],b=j[1],O=Object(o.useState)(null),h=Object(s.a)(O,2),m=h[0],f=h[1],x=Object(r.c)({title:"",reference:"",description:""}),v=x.setValues;return Object(o.useEffect)((function(){l.a.get(c).then((function(e){b(e),v({title:e.title||"",reference:e.reference||"",description:e.description||""})})).catch((function(e){e.response&&404===e.response.status?f("notfound"):f("error")}))}),[c,v]),m?Object(d.jsx)("div",{children:Object(d.jsx)("h1",{children:"Ce document n'existe pas"})}):u&&u.slug?Object(d.jsx)(F,Object(n.a)(Object(n.a)({},e),(t={docSlug:c,doc:u,setDoc:b},Object(a.a)(t,"docSlug",c),Object(a.a)(t,"form",x),t))):null}},88:function(e,t,c){"use strict";c.d(t,"a",(function(){return s}));var a=c(7),n=c(4),s={path:"documents/",list:function(e){return Object(n.g)(a.a,this.path,e)},get:function(e,t){return Object(n.g)(a.a,"".concat(this.path).concat(e,"/"),t)},patch:function(e,t,c){return a.h.patch("".concat(this.path).concat(e,"/"),t,c)},delete:function(e){return a.h.delete("".concat(this.path).concat(e,"/"))},postFile:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:isRequired("file"),t=e.name;if(t.length>=100)return Promise.reject("File name is too long");var c=new FormData;return c.append("src",e,t),a.h.post("docufiles/",c,{headers:{"content-type":"multipart/form-data"}})},getStaffList:function(e){return a.h.get("search-staff/",{q:e})},patchUser:function(e,t){return Object.keys(t).includes("action")?a.h.post("".concat(this.path).concat(e,"/users/"),t):Promise.reject("Action required")},patchFile:function(e,t){return Object.keys(t).includes("action")?a.h.post("".concat(this.path).concat(e,"/files/"),t):Promise.reject("Action required")}}},89:function(e,t,c){"use strict";c.d(t,"c",(function(){return w})),c.d(t,"a",(function(){return d}));var a=c(2),n=c(3),s=c(1),r=(c(94),c(16)),i=c.n(r),o=c(17),l=c(34),j=c(4),u=Object(s.createContext)(null),d=u.Provider,b=u,O=c(0),h=["onSave"],m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.forwardRef)((function(c,r){c=Object(a.a)(Object(a.a)({},t),c);var i=Object(s.useContext)(b)||Object(j.i)("FormCtx"),l=c.name,u=void 0===l?Object(j.i)("name prop"):l,d=c,m=d.value,f=d.checked;Object.keys(i.values).includes(u)&&("checkbox"===c.type?f=i.values[u]:m=i.values[u]);var x=c,v=x.onSave,p=Object(n.a)(x,h),g=Object(s.useRef)(Object(o.debounce)((function(e){if((!c.required||e.target.value)&&v&&Object(o.isFunction)(v))return v({name:e.target.name,value:e.target.value,e:e})}),500));return Object(O.jsx)(e,Object(a.a)(Object(a.a)({},p),{},{className:Object(j.e)([t.className,c.className]),value:m,checked:f,onChange:function(e){var t=c.onChange||i.handleChange;t&&(t(e),g.current&&g.current(e))},ref:r}))}))},f=m("input",{className:"miq-input"});f.propTypes={type:i.a.string,id:i.a.string,className:i.a.string,value:i.a.string,required:i.a.bool,disabled:i.a.bool};var x=m("textarea",{className:"miq-textarea"}),v=m(l.a);j.b&&(f.displayName="TextInput",x.displayName="TextArea",v.displayName="TextAreaX");var p=["value","children"];function g(e){var t=e.value,c=e.children,s=Object(n.a)(e,p),r={className:Object(j.e)(["miq-label",s.className])};return c?Object(O.jsx)("div",Object(a.a)(Object(a.a)(Object(a.a)({},s),r),{},{children:c})):t?Object(O.jsx)("label",Object(a.a)(Object(a.a)({htmlFor:s.id},r),{},{children:t})):null}var N=["label"],y=Object(s.forwardRef)((function(e,t){var c=e.label,r=Object(n.a)(e,N),i=Object(s.useContext)(b)||Object(j.i)("FormCtx"),o=r.name,l=void 0===o?Object(j.i)("name prop"):o,u=r.checked,d=r.onChange;return Object.keys(i.values).includes(l),d=d||i.toggleCheck,Object(O.jsxs)("div",{className:"miq-checkbox",children:[Object(O.jsx)("input",Object(a.a)(Object(a.a)({},r),{},{type:"checkbox",onChange:d,checked:u||i.values[l],ref:t})),Object(O.jsx)(g,{value:c,className:"miq-checkbox-label"})]})})),C=y;j.b&&(y.displayName="CheckboxInput");var k=c(33),S=c(15);function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(s.useState)(Object(a.a)({},e)),c=Object(S.a)(t,2),n=c[0],r=c[1],i=Object(s.useState)({}),o=Object(S.a)(i,2),l=o[0],j=o[1],u=function(e,t){r(Object(a.a)(Object(a.a)({},n),{},Object(k.a)({},e,t)))},d=function(e){var t=e.target.name;return u(t,!n[t])},b=function(e){switch(e.target.type){case"checkbox":return d(e);default:return u(e.target.name,e.target.value)}};return{values:n,handleChange:b,toggleCheck:d,setValue:u,setValues:r,errors:l,setErrors:j}}var A=["children","context"],I=Object(s.forwardRef)((function(e,t){var c=e.children,s=e.context,r=Object(n.a)(e,A);return Object(O.jsx)(d,{value:s,children:Object(O.jsx)("form",Object(a.a)(Object(a.a)({},r),{},{ref:t,children:c}))})}));I.Label=g,I.TextInput=f,I.CheckboxInput=C,I.TextArea=x,I.TextAreaX=v;t.b=I},94:function(e,t,c){}}]);
//# sourceMappingURL=5.681369cd.chunk.js.map