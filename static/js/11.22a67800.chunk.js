(this["webpackJsonp@grio/client"]=this["webpackJsonp@grio/client"]||[]).push([[11],{325:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var c=n(1),s=n(24),a=n(19),r=n(2),i=n(15),u=n(13),o=n(3),l=n(10),j=n(5),d=n(18),h=n(91),m=n(20),b=n(0);function f(e){var t=Object(m.c)({title:""});return Object(b.jsxs)(m.b,{context:t,onSubmit:function(n){n.preventDefault();var c=t.values.title;c?h.a.post({title:c}).then((function(t){return e.onSuccess(t)})).catch((function(e){return t.handleErr(e,!0)})):t.setError("title","Entrez le titre du nouveau document")},className:"document-add-form mb-3",children:[Object(b.jsx)("div",{className:"mb-1",children:Object(b.jsx)(m.b.TextInput,{required:!0,autoComplete:"off",name:"title",placeholder:"Entrez le titre du nouveau document",error:t.errors.title,maxLength:99})}),Object(b.jsxs)("div",{className:"d-flex align-items-center justify-content-between",children:[Object(b.jsx)("div",{className:"",children:Object(b.jsx)(d.a,{onClick:e.onCancel,children:"Annuler"})}),Object(b.jsx)("div",{className:"",children:Object(b.jsx)(m.b.Submit,{value:"Ajouter",className:"btn"})})]})]})}function p(e){var t=Object(r.useState)("loading"),n=Object(a.a)(t,2),i=(n[0],n[1]),o=Object(r.useState)({results:[]}),m=Object(a.a)(o,2),p=m[0],v=m[1],x=Object(r.useState)(!1),g=Object(a.a)(x,2),N=g[0],y=g[1],q=Object(r.useContext)(l.a).perms,w=e.location.search,P=new URLSearchParams(w),S=Object(r.useState)(P.get("q")||""),C=Object(a.a)(S,2),k=C[0],A=C[1],E=Object(r.useCallback)((function(){return h.a.list.apply(h.a,arguments)}),[]);Object(r.useEffect)((function(){var e=new URLSearchParams(w);Object(s.a)(e.values()).filter((function(e){return e})).length||(e=null),E(e).then((function(e){i(e?"done":"empty"),v(e)})).catch((function(e){i("error")}))}),[E,w]);var F=Object(j.i)(q.perms,["miq_dms.add_document"]),R=Object(r.useRef)(Object(u.debounce)((function(t){return e.history.push(t)}),300));return Object(b.jsxs)(j.f,{title:"Documents",className:"document-list-view mb-4",actions:Object(b.jsx)(b.Fragment,{children:Object(b.jsx)(d.d,{labelFirst:!0,Icon:d.f.Plus,label:"Ajouter",title:F?"Ajouter un nouveau document":"Vous ne pouvez pas ajouter de nouveau document",onClick:function(){return y(!N)},disabled:!F})}),children:[Object(b.jsx)("div",{className:"miq-container",children:N?Object(b.jsxs)("div",{className:"",children:[Object(b.jsx)("h3",{className:"mb-2",children:"Ajouter un nouveau document"}),Object(b.jsx)(f,{onSuccess:function(t){if(F){var n="".concat(e.match.path).concat(t.slug,"/");return e.history.push(n)}},onCancel:function(){return y(!1)}})]}):Object(b.jsxs)("div",{className:"mb-3",children:[Object(b.jsx)("input",{required:!0,type:"text",name:"q",value:k||"",onChange:function(e){var t=e.target.value;if(A(t),!t||t.length<3?P.delete("q"):P.set("q",e.target.value),R.current){var n=new URL(window.location.href);R.current("".concat(n.pathname,"?").concat(P))}},className:"miq-input",placeholder:"Chercher un document par titre, reference ou description"}),"Search tous-tous les Documents elements envoye elements recus archive"]})}),Object(b.jsx)("div",{className:"document-list mb-3",children:p.results.map((function(t){return Object(r.createElement)(O,Object(c.a)(Object(c.a)(Object(c.a)({},e),t),{},{key:t.slug}))}))}),Object(b.jsx)("div",{className:"mb-4",children:Object(b.jsx)(d.i,Object(c.a)(Object(c.a)({},p),{},{onPrevious:function(){return h.a.listPage(p.previous).then((function(e){v(e)}))},onNext:function(){return h.a.listPage(p.next).then((function(e){v(e)}))}}))})]})}var O=function(e){if(!e.slug)return null;var t=e.status,n=e.is_read_only,c="ARCHIVED"===t,s="".concat(e.match.path).concat(e.slug,"/");return n&&(s="".concat(s,"view/")),Object(b.jsx)(i.b,{to:s,className:"document-list-link",children:Object(b.jsxs)("div",{className:"d-flex justify-content-between",children:[Object(b.jsxs)("div",{className:"document-title flex-1",children:[Object(b.jsx)("div",{className:"",children:e.title_truncated}),Object(b.jsx)("span",{className:"text-sm",children:Object(o.e)(e.created,{month:"numeric",day:"numeric",year:"numeric"})}),c&&Object(b.jsx)("span",{className:"text-sm",children:" - Archiv\xe9"})]}),Object(b.jsxs)("div",{className:"document-meta text-muted ps-1",children:[e.users.length>0&&Object(b.jsxs)("span",{className:"me-1 d-flex align-items-center",children:[Object(b.jsx)("span",{className:"count",children:e.users.length}),Object(b.jsx)(d.f.PersonCircle,{})]}),e.files.length>0&&Object(b.jsxs)("span",{className:"me-1 d-flex align-items-center",children:[Object(b.jsx)("span",{className:"count",children:e.files.length}),Object(b.jsx)(d.f.FileEarmarkText,{})]})]})]})})}},91:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var c=n(5),s=n(3),a={path:"documents/",list:function(e){return Object(s.h)(c.a,this.path,e)},listPage:function(e){return Object(s.h)(c.a,e)},get:function(e,t){return Object(s.h)(c.a,"".concat(this.path).concat(e,"/"),t)},post:function(e){return c.j.post("".concat(this.path),e)},patch:function(e,t,n){return c.j.patch("".concat(this.path).concat(e,"/"),t,n)},archive:function(e){return c.j.get("".concat(this.path).concat(e,"/archive/"))},delete:function(e){return c.j.delete("".concat(this.path).concat(e,"/"))},postFile:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:isRequired("file"),t=e.name;if(t.length>=100)return Promise.reject("File name is too long");var n=new FormData;return n.append("src",e,t),c.j.post("docufiles/",n,{headers:{"content-type":"multipart/form-data"}})},patchFile:function(e,t){return Object.keys(t).includes("action")?c.j.post("".concat(this.path).concat(e,"/files/"),t):Promise.reject("Action required")},patchUserPermission:function(e,t,n){return c.j.post("".concat(this.path).concat(e,"/permission/"),{user_slug:t,permission:n})},getStaffList:function(e){return c.j.get("search-staff/",{q:e})},patchUser:function(e,t){return Object.keys(t).includes("action")?c.j.post("".concat(this.path).concat(e,"/users/"),t):Promise.reject("Action required")}}}}]);
//# sourceMappingURL=11.22a67800.chunk.js.map