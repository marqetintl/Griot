{"version":3,"sources":["../../../../../packages/miq-dms/src/document/AddForm.jsx","../../../../../packages/miq-dms/src/document/ListView/index.jsx","../../../../../packages/miq-dms/src/document/utils.jsx"],"names":["DocumentAddForm","props","form","useForm","title","context","onSubmit","e","preventDefault","values","docServices","post","then","newData","onSuccess","catch","err","handleErr","setError","className","TextInput","required","autoComplete","name","placeholder","error","errors","maxLength","onClick","onCancel","Submit","value","DocumentListView","useState","setStatus","results","data","setData","isAdding","setAdding","perms","useContext","SharedDataCtx","search","location","query","URLSearchParams","get","q","setQ","getDocuments","useCallback","list","useEffect","params","filter","i","length","canAdd","hasPerms","push","useRef","debounce","url","history","actions","labelFirst","Icon","Icons","Plus","label","disabled","newDocument","match","path","slug","type","onChange","target","delete","set","current","URL","window","href","pathname","items","renderItem","item","key","pagination","count","next","previous","onPreviousClick","listPage","onNextClick","DocumentListLink","status","is_read_only","isArchived","link","to","title_truncated","formatDate","created","month","day","year","users","PersonCircle","files","FileEarmarkText","getService","API","this","docSlug","services","patch","oldValues","archive","patchUserPermission","user_slug","permission","getStaffList","patchUser","Object","keys","includes","Promise","reject"],"mappings":"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","file":"static/js/12.d7de7615.chunk.js","sourcesContent":["import Form, { useForm } from \"@miq/form\";\nimport { Button } from \"@miq/components\";\n\nimport { docServices } from \"./utils\";\n\nexport default function DocumentAddForm(props) {\n    const form = useForm({ title: \"\" });\n\n    const handleSubmit = (e) => {\n        e.preventDefault();\n        const { title } = form.values;\n\n        if (!title) {\n            form.setError(\"title\", \"Entrez le titre du nouveau document\");\n            return;\n        }\n\n        docServices\n            .post({ title })\n            .then((newData) => props.onSuccess(newData))\n            .catch((err) => form.handleErr(err, true));\n    };\n\n    return (\n        <Form context={form} onSubmit={handleSubmit} className=\"document-add-form mb-3\">\n            <div className=\"mb-1\">\n                <Form.TextInput\n                    required\n                    autoComplete=\"off\"\n                    name=\"title\"\n                    placeholder=\"Entrez le titre du nouveau document\"\n                    error={form.errors.title}\n                    maxLength={99}\n                />\n            </div>\n\n            <div className=\"d-flex align-items-center justify-content-between\">\n                <div className=\"\">\n                    <Button onClick={props.onCancel}>Annuler</Button>\n                </div>\n\n                <div className=\"\">\n                    <Form.Submit value=\"Ajouter\" className=\"btn\" />\n                </div>\n            </div>\n        </Form>\n    );\n}\n","import { useCallback, useContext, useEffect, useRef, useState } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { debounce } from \"lodash\";\n\nimport { formatDate } from \"@miq/utils\";\nimport { SharedDataCtx } from \"@miq/contexts\";\nimport { AdminView, hasPerms } from \"@miq/admin\";\nimport { Icons, IconButton, ItemList } from \"@miq/components\";\n\nimport { docServices } from \"../utils\";\nimport DocumentAddForm from \"../AddForm\";\n\nexport default function DocumentListView(props) {\n    const [status, setStatus] = useState(\"loading\");\n\n    const [data, setData] = useState({ results: [] });\n    const [isAdding, setAdding] = useState(false);\n    const { perms } = useContext(SharedDataCtx);\n\n    const { search } = props.location;\n    const query = new URLSearchParams(search);\n    const [q, setQ] = useState(query.get(\"q\") || \"\");\n\n    const getDocuments = useCallback((...params) => docServices.list(...params), []);\n\n    useEffect(() => {\n        let params = new URLSearchParams(search);\n        if (![...params.values()].filter((i) => i).length) {\n            params = null;\n        }\n\n        getDocuments(params)\n            .then((data) => {\n                if (!data) {\n                    setStatus(\"empty\");\n                } else {\n                    setStatus(\"done\");\n                }\n\n                setData(data);\n            })\n            .catch((err) => {\n                setStatus(\"error\");\n            });\n    }, [getDocuments, search]);\n\n    const canAdd = hasPerms(perms.perms, [\"miq_dms.add_document\"]);\n\n    const handleDocumentAdd = (newDocument) => {\n        if (!canAdd) return;\n\n        const url = `${props.match.path}${newDocument.slug}/`;\n        return props.history.push(url);\n    };\n\n    const push = useRef(debounce((url) => props.history.push(url), 300));\n\n    return (\n        <AdminView\n            title=\"Documents\"\n            className=\"document-list-view mb-4\"\n            actions={\n                <>\n                    <IconButton\n                        labelFirst\n                        Icon={Icons.Plus}\n                        label=\"Ajouter\"\n                        title={\n                            canAdd ? \"Ajouter un nouveau document\" : \"Vous ne pouvez pas ajouter de nouveau document\"\n                        }\n                        onClick={() => setAdding(!isAdding)}\n                        disabled={!canAdd}\n                    />\n                </>\n            }\n        >\n            <div className=\"miq-container\">\n                {isAdding ? (\n                    <div className=\"\">\n                        <h3 className=\"mb-2\">Ajouter un nouveau document</h3>\n                        <DocumentAddForm onSuccess={handleDocumentAdd} onCancel={() => setAdding(false)} />\n                    </div>\n                ) : (\n                    <div className=\"mb-3\">\n                        <input\n                            required\n                            type=\"text\"\n                            name=\"q\"\n                            value={q || \"\"}\n                            onChange={(e) => {\n                                const { value } = e.target;\n\n                                setQ(value);\n\n                                if (!value || value.length < 3) {\n                                    query.delete(\"q\");\n                                } else {\n                                    query.set(\"q\", e.target.value);\n                                }\n\n                                if (!push.current) return;\n\n                                const path = new URL(window.location.href);\n                                push.current(`${path.pathname}?${query}`);\n                            }}\n                            className=\"miq-input\"\n                            placeholder=\"Chercher un document par titre, reference ou description\"\n                        />\n                        Search tous-tous les Documents elements envoye elements recus archive\n                    </div>\n                )}\n            </div>\n\n            <div className=\"document-list mb-3\">\n                <ItemList\n                    items={data.results}\n                    renderItem={(item) => <DocumentListLink {...props} {...item} key={item.slug} />}\n                    pagination={{\n                        count: data.count,\n                        next: data.next,\n                        previous: data.previous,\n                        onPreviousClick: () =>\n                            docServices.listPage(data.previous).then((newData) => {\n                                setData(newData);\n                            }),\n                        onNextClick: () =>\n                            docServices.listPage(data.next).then((newData) => {\n                                setData(newData);\n                            }),\n                    }}\n                />\n            </div>\n        </AdminView>\n    );\n}\n\nconst DocumentListLink = (props) => {\n    if (!props.slug) return null;\n\n    const { status, is_read_only } = props;\n    const isArchived = status === \"ARCHIVED\";\n\n    let link = `${props.match.path}${props.slug}/`;\n    if (is_read_only) link = `${link}view/`;\n\n    return (\n        <Link to={link} className=\"document-list-link\">\n            <div className=\"d-flex justify-content-between\">\n                <div className=\"document-title flex-1\">\n                    <div className=\"\">{props.title_truncated}</div>\n                    <span className=\"text-sm\">\n                        {formatDate(props.created, { month: \"numeric\", day: \"numeric\", year: \"numeric\" })}\n                    </span>\n                    {isArchived && <span className=\"text-sm\"> - Archivé</span>}\n                </div>\n\n                <div className=\"document-meta text-muted ps-1\">\n                    {props.users.length > 0 && (\n                        <span className=\"me-1 d-flex align-items-center\">\n                            <span className=\"count\">{props.users.length}</span>\n                            <Icons.PersonCircle />\n                        </span>\n                    )}\n\n                    {props.files.length > 0 && (\n                        <span className=\"me-1 d-flex align-items-center\">\n                            <span className=\"count\">{props.files.length}</span>\n                            <Icons.FileEarmarkText />\n                        </span>\n                    )}\n                </div>\n            </div>\n        </Link>\n    );\n};\n","import { API, services } from \"@miq/admin\";\nimport { getService } from \"@miq/utils\";\nimport { addOrUpdateArrayObject } from \"@miq/utils\";\n\nexport const docServices = {\n    path: \"documents/\",\n\n    /**\n     * DOCUMENT\n     */\n\n    list(params) {\n        return getService(API, this.path, params);\n    },\n    listPage(url) {\n        return getService(API, url);\n    },\n    get(docSlug, params) {\n        return getService(API, `${this.path}${docSlug}/`, params);\n    },\n    post(values) {\n        return services.post(`${this.path}`, values);\n    },\n    patch(docSlug, values, oldValues) {\n        return services.patch(`${this.path}${docSlug}/`, values, oldValues);\n    },\n    archive(docSlug) {\n        return services.get(`${this.path}${docSlug}/archive/`);\n    },\n    delete(docSlug) {\n        return services.delete(`${this.path}${docSlug}/`);\n    },\n\n    /**\n     * USER\n     */\n\n    patchUserPermission(docSlug, user_slug, permission) {\n        return services.post(`${this.path}${docSlug}/permission/`, { user_slug, permission });\n    },\n\n    getStaffList(q) {\n        return services.get(\"search-staff/\", { q });\n    },\n\n    patchUser(docSlug, values) {\n        if (!Object.keys(values).includes(\"action\")) {\n            return Promise.reject(\"Action required\");\n        }\n\n        return services.post(`${this.path}${docSlug}/users/`, values);\n    },\n};\n\nexport const docsReducer = (state = { results: [] }, action) => {\n    const { type, payload = {} } = action;\n    let results;\n\n    switch (type) {\n        case \"SET_DOCS\":\n            return { ...payload };\n\n        case \"APPEND_DOC\":\n            results = addOrUpdateArrayObject(state.results, payload, \"slug\", true);\n            return { ...state, results };\n\n        case \"ADD_UPDATE_DOC\":\n        case \"PREPEND_DOC\":\n            results = addOrUpdateArrayObject(state.results, payload);\n            return { ...state, results };\n\n        case \"REMOVE_DOC\":\n            results = state.results.filter(({ slug }) => slug !== payload.slug);\n            return { ...state, results };\n\n        default:\n            return { ...state };\n    }\n};\n"],"sourceRoot":""}