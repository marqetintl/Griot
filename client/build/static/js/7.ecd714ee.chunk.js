(this["webpackJsonp@grio/client"]=this["webpackJsonp@grio/client"]||[]).push([[7],{107:function(e,t,c){"use strict";c.r(t),c.d(t,"default",(function(){return I}));var n=c(19),s=c(1),a=c(11),r=c(2),i=c(9),l=c(17),o=c(7),d=c(3),u=c(5),j=(c(166),c(119)),b=c(4),f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:isRequired("file"),t=e.name;if(t.length>=300)return Promise.reject({files:"File name is too long"});var c=new FormData;return c.append("src",e,t),o.l.post("docufiles/",c,{headers:{"content-type":"multipart/form-data"}})},m=function(e,t){return o.l.delete("docufiles/".concat(e,"/?document=").concat(t))},O=c(0),h=["onSuccess"],x=function(e){var t=e.name_truncated;return Object(O.jsxs)("div",{children:[Object(O.jsx)("span",{className:"fw-bold d-block",children:"File Added"}),t]})};function p(e){var t=e.onSuccess,c=Object(b.a)(e,h),n=Object(r.useContext)(u.s),a=Object(r.createRef)();return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(u.h,Object(s.a)(Object(s.a)({Icon:u.j.PaperClip,label:"Joindre",title:"Joindre des fichiers \xe0 ce document"},c),{},{onClick:function(){return a.click()}})),Object(O.jsx)(u.g,{onChange:function(e){Array.from(e.target.files).forEach((function(e){f(e).then((function(e){t&&t(e),n&&n.success({component:Object(O.jsx)(x,Object(s.a)({},e))})})).catch((function(e){n&&n.error({message:"File upload failed.\nPlease try again."})}))}))},ref:function(e){return a=e}})]})}c(141);var v=["document","file"],g=function(e){var t=e.document,c=e.file,n=Object(b.a)(e,v),a=Object(r.useContext)(u.s);if(!t||t.is_read_only)return null;var i=function(){return m(c.slug,t.slug).then((function(e){n.onFileDelete(Object(s.a)(Object(s.a)({},e),{},{slug:c.slug})),a.success({message:"File deleted."})})).catch((function(e){a.error({message:"Something went wrong."})}))};return Object(O.jsx)(u.f,{disabled:t.is_read_only,Icon:u.j.Trash,render:function(){return Object(O.jsx)("div",{className:"p-3",children:"Are you sure?"})},renderHeader:function(){return Object(O.jsxs)("div",{className:"flex-1 fw-bold",children:["Delete file ","".concat(t.title_truncated)]})},renderFooter:function(e){var t=e.setOpen;return Object(O.jsxs)("div",{className:"flex-1",children:[Object(O.jsx)(u.d,{onClick:function(){return t(!1)},className:"me-1",children:"Annuler"}),Object(O.jsx)(u.d,{className:"btn-danger",onClick:i,children:"Delete"})]})}})},N=c(6),y=["items"],_=function(e){switch(e.ext){case".jpg":case".jpeg":case".png":return Object(O.jsx)(u.l,Object(s.a)({},e));default:var t=u.j.getFileIcon(e.ext);return Object(O.jsx)(t,{className:"icon mb-1"})}};function S(e){var t=e.items,c=Object(b.a)(e,y);return Object(N.isArray)(t)?!t.length>0?Object(O.jsx)("div",{className:"w-100 text-center py-4 bg-gray-100 rounded",children:"Ce document n'a pas de fichiers ajout\xe9s."}):Object(O.jsx)("div",{className:"docufile-list border-1 rounded mb-3",style:{overflowX:"scroll"},children:Object(O.jsx)(u.n,{items:t,renderItem:function(e){return Object(O.jsxs)(u.q.Tr,{className:"docufile-list-item border-bottom",children:[Object(O.jsx)(u.q.Td,{children:Object(O.jsx)("a",{href:Object(d.i)(e.src),className:"docufile-btn",target:"_blank",children:Object(O.jsxs)("div",{className:"d-flex",children:[Object(O.jsx)("span",{className:"docufile-icon-wrapper d-none d-md-block me-1",children:_(e)}),Object(O.jsxs)("div",{className:"",children:[Object(O.jsx)("div",{children:e.name_truncated}),Object(O.jsx)("span",{className:"text-sm text-muted",children:e.size})]})]})})}),Object(O.jsx)(u.q.Td,{align:"right",children:Object(O.jsx)("div",{className:"actions",children:Object(O.jsx)(g,Object(s.a)(Object(s.a)({},c),{},{file:e}))})})]},e.slug)},className:"w-100"})}):null}var w=c(21),C=c(31),F=["docSlug"];function k(e){e.docSlug;var t=Object(b.a)(e,F),c=t.form,n=void 0===c?Object(d.l)("form"):c,s=t.doc,a=t.handleTextInputSave;return Object(O.jsxs)(l.a,{value:n,children:[Object(O.jsxs)("div",{className:"document-field d-grid grid-lg-12 mb-2",children:[Object(O.jsx)(l.b.Label,{value:"Reference",className:"span-12 mb-1"}),Object(O.jsx)(l.b.TextInput,{name:"reference",onSave:a,autoComplete:"off",className:"span-12 span-md-4",placeholder:"Ajouter une reference ...",disabled:s.is_read_only})]}),Object(O.jsxs)("div",{className:"document-field d-grid grid-1 grid-xl-12 mb-2",children:[Object(O.jsx)(l.b.Label,{value:"Description",className:"span-12 mb-1"}),Object(O.jsx)("div",{className:"span-lg-8",children:Object(O.jsx)(l.b.TextAreaX,{name:"description",onSave:a,placeholder:"Ajouter une description ...",disabled:s.is_read_only})})]})]})}var A=function(e){var t=e.docSlug,c=e.doc,n=e.toast,i=Object(r.useState)(!1),l=Object(a.a)(i,2),o=(l[0],l[1],function(s){var a="".concat(Object(d.e)(e.match.url),"view/");if("ARCHIVED"===c.status)return e.history.push(a);w.a.archive(t).then((function(){e.history.push(a)})).catch((function(){n.error({message:"Oops! Something went wrong."})}))}),j=e.match.path,b=Object(d.e)(e.match.url);return Object(O.jsxs)("div",{className:"document-update-view-actions",children:[Object(O.jsxs)("div",{className:"d-flex me-2",children:[Object(O.jsx)(C.b,Object(s.a)(Object(s.a)({},e),{},{docSlug:t,label:"Supprimer",className:"btn-secondary-4 me-1",onSuccess:function(){return e.history.push(j.replace(":docSlug/",""))}})),Object(O.jsx)(C.c,{doc:c,onClick:o,className:"btn-primary-3"}),Object(O.jsx)(C.a,{doc:c,onClick:o,className:"btn-primary-3"})]}),Object(O.jsx)("div",{children:Object(O.jsx)(u.i,{to:"".concat(b,"share/"),disabled:c.is_read_only,Icon:u.j.Share,className:"btn-primary",label:"Partager",title:"Partager ce document avec des personnes"})})]})};function I(e){var t,c=e.match.params.docSlug,b=Object(r.useState)(null),f=Object(a.a)(b,2),m=f[0],h=f[1],x=Object(r.useState)(null),v=Object(a.a)(x,2),g=v[0],N=v[1],y=Object(r.useContext)(u.s),_=Object(l.c)({title:"",reference:"",description:""}),F=_.setValues;if(Object(r.useEffect)((function(){w.a.detail(c).then((function(e){h(e),e.is_read_only||F({title:e.title||"",reference:e.reference||"",description:e.description||""})})).catch((function(e){e.response&&404===e.response.status?N("notfound"):N("error")}))}),[c,F]),g)return Object(O.jsx)("div",{children:Object(O.jsx)("h1",{children:"Ce document n'existe pas"})});if(!m||!m.slug)return null;if(m.is_read_only)return Object(O.jsx)(i.a,{to:"".concat(Object(d.e)(e.match.url),"view/")});var I=function(e){var t=e.name,s=e.value;m&&!m.is_read_only&&w.a.patch(c,Object(n.a)({},t,s),Object(n.a)({},t,m[t])).then((function(e){})).catch((function(e){}))},D=Object(s.a)(Object(s.a)({},e),{},(t={toast:y,docSlug:c,doc:m,setDoc:h},Object(n.a)(t,"docSlug",c),Object(n.a)(t,"form",_),Object(n.a)(t,"handleTextInputSave",I),t));return Object(O.jsx)(l.b,{context:_,className:"document-update-form",children:Object(O.jsxs)(o.g,{className:"document-update-view miq-container-fluid",title:Object(O.jsx)(j.a,{className:"btn-secondary-4"}),actions:Object(O.jsx)(A,Object(s.a)({},D)),children:[Object(O.jsx)("div",{className:"my-3",children:Object(O.jsx)(C.d,{onSave:I})}),Object(O.jsx)("div",{className:"mb-3",children:Object(O.jsx)(k,Object(s.a)({},D))}),Object(O.jsxs)("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[Object(O.jsx)("div",{className:"fw-bold text-md",children:"Fichiers"}),Object(O.jsx)("div",{className:"actions",children:Object(O.jsx)(p,{onSuccess:function(e){var t=e.slug;return w.a.patchFile(c,{action:"add",files:[t]}).then((function(e){h(Object(s.a)(Object(s.a)({},m),e))})).catch((function(e){}))},disabled:m.is_read_only,className:"btn-primary-2"})})]}),Object(O.jsx)(S,{document:m,items:m.files_data,onFileDelete:function(e){var t=e.slug;return h(Object(s.a)(Object(s.a)({},m),{},{files:m.files.filter((function(e){return e!==t})),files_data:m.files_data.filter((function(e){return e.slug!==t}))}))}})]})})}},119:function(e,t,c){"use strict";c.d(t,"a",(function(){return i}));c(2);var n=c(7),s=c(5),a=c(21),r=c(0),i=function(e){return Object(r.jsx)(n.d,{to:e.to||a.b.staff_path,Icon:s.j.ArrowLeft,title:"Retourner aux documents",className:e.className})}},141:function(e,t,c){},166:function(e,t,c){}}]);
//# sourceMappingURL=7.ecd714ee.chunk.js.map