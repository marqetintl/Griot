(this["webpackJsonp@grio/client"]=this["webpackJsonp@grio/client"]||[]).push([[7],{124:function(e,t,c){},125:function(e,t,c){"use strict";c.d(t,"a",(function(){return d})),c.d(t,"c",(function(){return j})),c.d(t,"b",(function(){return b}));var n=c(4),s=c(8),a=(c(3),c(9)),r=c(95),i=c(0),l=["doc","docSlug","onSuccess"],o=["document"],u=["document"],d=function(e){var t=e.doc,c=e.docSlug,o=e.onSuccess,u=Object(n.a)(e,l);if(!t||t.is_read_only)return null;var d=function(){return r.a.delete(c).then((function(e){Object(s.isFunction)(o)&&o(c)})).catch((function(e){}))};return Object(i.jsx)(a.e,{Icon:a.i.Trash,id:u.id,label:u.label,className:u.className,title:"Supprimer ce document",renderHeader:function(){return Object(i.jsx)("div",{children:Object(i.jsx)("h3",{children:"Supprimer ce document"})})},renderFooter:function(e){var c=e.setOpen;return Object(i.jsxs)("div",{className:"flex-1 d-flex align-items-center justify-content-between",children:[Object(i.jsx)(a.c,{disabled:t.is_read_only,onClick:d,className:"btn-danger",children:"Confirmer"}),Object(i.jsx)(a.c,{onClick:function(){return c(!1)},children:"Annuler"})]})},render:function(){return Object(i.jsxs)("div",{className:"p-4",children:[Object(i.jsx)("p",{children:"Are you sure you want to delete \u201c2. Parties in Payment Gateway business\u201d?"}),Object(i.jsx)("p",{children:"This item will be deleted immediately. You can\u2019t undo this action."})]})},disabled:t.is_read_only})},j=function(e){var t=e.document,c=void 0===t?{}:t;Object(n.a)(e,o);return c&&c.users&&c.users.length?Object(i.jsxs)("span",{className:"me-1 d-flex align-items-center",children:[Object(i.jsx)("span",{className:"count",children:c.users.length}),Object(i.jsx)(a.i.PersonCircle,{})]}):null},b=function(e){var t=e.document,c=void 0===t?{}:t;Object(n.a)(e,u);return c&&c.files&&c.files.length?Object(i.jsxs)("span",{className:"me-1 d-flex align-items-center",children:[Object(i.jsx)("span",{className:"count",children:c.files.length}),Object(i.jsx)(a.i.FileEarmarkText,{})]}):null}},348:function(e,t,c){},349:function(e,t,c){},352:function(e,t,c){"use strict";c.r(t),c.d(t,"default",(function(){return R}));var n=c(18),s=c(1),a=c(16),r=c(2),i=c(20),l=c(5),o=c(3),u=c(9),d=(c(348),c(4)),j=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:isRequired("file"),t=e.name;if(t.length>=300)return Promise.reject({files:"File name is too long"});var c=new FormData;return c.append("src",e,t),l.k.post("docufiles/",c,{headers:{"content-type":"multipart/form-data"}})},b=function(e,t){return l.k.delete("docufiles/".concat(e,"/?document=").concat(t))},m=c(0),h=["onSuccess"];function f(e){var t=e.onSuccess,c=Object(d.a)(e,h),n=Object(r.createRef)();return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(u.g,Object(s.a)(Object(s.a)({Icon:u.i.PaperClip,label:"Joindre",title:"Joindre des fichiers \xe0 ce document"},c),{},{onClick:function(){return n.click()}})),Object(m.jsx)(u.f,{onChange:function(e){Array.from(e.target.files).forEach((function(e){j(e).then((function(e){t&&t(e)})).catch((function(e){console.log(e)}))}))},ref:function(e){return n=e}})]})}c(124);var O=["items"],x=function(e){switch(e.ext){case".jpg":case".jpeg":case".png":return Object(m.jsx)(u.k,Object(s.a)({},e));default:var t=u.i.getFileIcon(e.ext);return Object(m.jsx)(t,{className:"icon mb-1"})}};function v(e){var t=e.items,c=Object(d.a)(e,O),n=c.document,a=c.onFileDelete;return Object(m.jsx)("div",{className:"docufile-list border-1 rounded mb-3",style:{overflowX:"scroll"},children:Object(m.jsx)(u.m,{items:t,renderItem:function(e){return Object(m.jsxs)(u.p.Tr,{className:"docufile-list-item border-bottom",children:[Object(m.jsx)(u.p.Td,{children:Object(m.jsx)("a",{href:Object(o.g)(e.src),className:"docufile-btn",target:"_blank",children:Object(m.jsxs)("div",{className:"d-flex",children:[Object(m.jsx)("span",{className:"docufile-icon-wrapper d-none d-md-block me-1",children:x(e)}),Object(m.jsxs)("div",{className:"",children:[Object(m.jsx)("div",{children:e.name_truncated}),Object(m.jsx)("span",{className:"text-sm text-muted",children:e.size})]})]})})}),Object(m.jsx)(u.p.Td,{align:"right",children:Object(m.jsx)("div",{className:"actions",children:!n.is_read_only&&Object(m.jsx)(u.e,{disabled:n.is_read_only,Icon:u.i.Trash,render:function(){return Object(m.jsx)("div",{children:"Are you sure?"})},renderFooter:function(t){var c=t.setOpen;return Object(m.jsxs)("div",{className:"flex-1",children:[Object(m.jsx)(u.c,{onClick:function(){return c(!1)},className:"me-1",children:"Annuler"}),Object(m.jsx)(u.c,{className:"btn-danger",onClick:function(){return b(e.slug,n.slug).then((function(t){a(Object(s.a)(Object(s.a)({},t),{},{slug:e.slug}))})).catch((function(e){console.log(e)}))},children:"Delete"})]})}})})})]},e.slug)},className:"w-100"})})}var p=c(95),g=c(125),N=c(8),y=["form","doc"],_=["user","doc"];function S(e){var t=e.form,c=e.doc,n=Object(d.a)(e,y),l=Object(r.useState)(""),o=Object(a.a)(l,2),j=o[0],b=o[1],h=Object(r.useState)([]),f=Object(a.a)(h,2),O=f[0],x=f[1],v=Object(r.useCallback)(Object(N.debounce)((function(e){return p.a.getStaffList(e).then((function(e){var t=e.results;x(t)}))}),400),[]);if(Object(r.useEffect)((function(){!j||j.length<3||v(j)}),[j,v]),!t||!c)return null;return Object(m.jsx)(u.o,{children:Object(m.jsx)(i.b,{context:t,id:"DocumentShareModal",className:"dms-share",children:Object(m.jsx)(u.o.Modal,{header:Object(m.jsxs)("div",{className:"dms-share-header",children:[Object(m.jsxs)("div",{className:"title",children:[Object(m.jsx)("div",{className:"btn btn-icon select",children:Object(m.jsx)(u.i.PersonPlus,{className:"icon"})}),Object(m.jsx)("h2",{children:"Partager avec des personnes"})]}),Object(m.jsx)("div",{className:"actions",children:Object(m.jsx)(u.g,{Icon:u.i.X,onClick:n.closeModal})})]}),footer:Object(m.jsx)("div",{className:"dms-share-footer",children:Object(m.jsx)("div",{className:"",children:Object(m.jsx)(u.c,{onClick:n.closeModal,children:"Termin\xe9"})})}),children:Object(m.jsxs)("div",{className:"dms-share-select",children:[Object(m.jsx)(u.d,{floating:!0,header:Object(m.jsx)("input",{required:!0,name:"q",onChange:function(e){return b(e.target.value)},placeholder:"Ajouter des personnes",className:"miq-input mb-1"}),isOpen:j.length>2&&O.length>0,children:O.map((function(e,n){return Object(m.jsx)("div",{className:"dms-user-item",onClick:function(){return function(e){c.users.includes(e.slug)||t.setValue("user",e)}(e)},role:"button",children:Object(m.jsx)(P,{user:e,form:t})},"".concat(e.slug,"-").concat(n))}))}),Object(m.jsx)("div",{className:"dms-share-users my-2",children:c.users_data.map((function(e){return Object(m.jsxs)("div",{className:"my-1 d-flex align-items-center justify-content-between",children:[Object(m.jsx)(P,{user:e,form:t}),Object(m.jsxs)("div",{className:"d-flex align-items-center",children:[Object(m.jsx)(k,{user:e,doc:c,form:t,setDoc:n.setDoc,className:"me-1"}),Object(m.jsx)(u.g,{Icon:u.i.X,onClick:function(){p.a.patchUser(c.slug,{action:"remove",users:[e.slug]}).then((function(e){n.setDoc(Object(s.a)(Object(s.a)({},c),e))})).catch((function(e){console.log(e)}))},title:"Supprimer cet utilisateur"})]})]},e.slug)}))})]})})})})}var k=function(e){var t=e.user,c=e.doc,n=Object(d.a)(e,_),i=Object(r.useState)(t.permission||"VIEW"),l=Object(a.a)(i,2),o=l[0],u=l[1],j=Object.values(c.permissions);return Object(m.jsx)("select",{value:o,className:"miq-select me-1",onChange:function(e){var a=e.target.value;u(a),p.a.patchUserPermission(c.slug,t.slug,a).then((function(e){return n.setDoc(Object(s.a)(Object(s.a)({},c),e))}))},children:j.map((function(e){return Object(m.jsx)("option",{value:e.value,children:e.label},e.name)}))})};var C=["form","doc"];function w(e){var t=e.form,c=e.doc,n=Object(d.a)(e,C),a=t.values.user;if(!t)return null;return Object(m.jsx)(u.o,{children:Object(m.jsx)(i.b,{context:t,id:"DocumentShareModal",className:"dms-share",children:Object(m.jsx)(u.o.Modal,{header:Object(m.jsxs)("div",{className:"dms-share-header",children:[Object(m.jsxs)("div",{className:"title",children:[Object(m.jsx)("div",{children:Object(m.jsx)(u.g,{Icon:u.i.ArrowLeft,onClick:function(){return t.setValue("user","")},title:"Retourner derriere",className:"add"})}),Object(m.jsx)("h2",{children:"Partager avec des personnes"})]}),Object(m.jsx)("div",{className:"actions"})]}),footer:Object(m.jsx)("div",{className:"dms-share-footer",children:Object(m.jsx)("div",{className:"",children:Object(m.jsx)(u.c,{onClick:function(){var e=t.values.user.slug;e!==c.uploaded_by.slug&&p.a.patchUser(c.slug,{action:"add",users:[e]}).then((function(e){n.setDoc(Object(s.a)(Object(s.a)({},c),e)),t.setValue("user",null)})).catch((function(e){console.log(e)}))},children:"Envoyer"})})}),children:Object(m.jsxs)("div",{className:"dms-share-add",children:[Object(m.jsx)("div",{className:"",children:Object(m.jsx)(P,{user:a})}),Object(m.jsxs)("div",{className:"add-form mt-2",children:[Object(m.jsx)(i.b.CheckboxInput,{name:"sendNotif",checked:t.values.sendNotif,label:"Envoyer une notification"}),Object(m.jsx)(i.b.TextArea,{name:"message",placeholder:"Message",maxLength:200,rows:4,className:"my-1"})]})]})})})})}c(349);var I=["user","form"];function A(e){var t=Object(i.c)({q:"",user:null,sendNotif:!0,message:""});if(!e.isOpen)return null;var c=function(){return e.setOpen(!1)};return t.values.user?Object(m.jsx)(w,Object(s.a)(Object(s.a)({},e),{},{form:t,closeModal:c})):Object(m.jsx)(S,Object(s.a)(Object(s.a)({},e),{},{form:t,closeModal:c}))}var P=function(e){var t=e.user;e.form,Object(d.a)(e,I);return Object(m.jsxs)("div",{className:"d-flex align-items-center",children:[Object(m.jsx)("div",{className:"",children:Object(m.jsx)(u.a,Object(s.a)({},t.img_data))}),Object(m.jsxs)("div",{className:"ms-1",children:[Object(m.jsx)("div",{className:"",children:t.name}),Object(m.jsxs)("div",{className:"text-sm text-muted",children:["@",t.username]})]})]})},T=["docSlug"];function D(e){e.docSlug;var t=Object(d.a)(e,T),c=t.form,n=void 0===c?Object(o.j)("form"):c,s=t.doc,a=t.handleTextInputSave;return Object(m.jsxs)(i.a,{value:n,children:[Object(m.jsxs)("div",{className:"d-grid grid-lg-12 mb-2",children:[Object(m.jsx)(i.b.Label,{value:"Reference",className:"span-12 mb-1"}),Object(m.jsx)(i.b.TextInput,{name:"reference",onSave:a,autoComplete:"off",className:"span-12 span-md-4",placeholder:"Ajouter une reference ...",disabled:s.is_read_only})]}),Object(m.jsxs)("div",{className:"d-grid grid-1 grid-xl-12 mb-2",children:[Object(m.jsx)(i.b.Label,{value:"Description",className:"span-12 mb-1"}),Object(m.jsx)("div",{className:"span-lg-8",children:Object(m.jsx)(i.b.TextAreaX,{name:"description",onSave:a,placeholder:"Ajouter une description ...",disabled:s.is_read_only})})]})]})}var F=c(7),q=function(e){var t=e.doc,c=Object(r.useState)(!1),n=Object(a.a)(c,2),l=n[0],o=n[1];return Object(m.jsxs)("div",{className:"document-update-header border-bottom mt-1 py-1",children:[Object(m.jsx)("div",{className:"pe-1",children:Object(m.jsx)(u.h,{to:e.match.path.replace(":docSlug/",""),Icon:u.i.ArrowLeft,title:"Retourner en arriere",className:""})}),Object(m.jsx)("div",{className:"flex-1",children:Object(m.jsx)(i.b.TextInput,{required:!0,name:"title",onSave:e.handleTextInputSave,disabled:t.is_read_only,autoComplete:"off",tabIndex:0,"aria-label":"Renommer ce document",title:"Renommer ce document","data-tooltip":"Renommer ce document"})}),Object(m.jsxs)("div",{className:"ps-1",children:[Object(m.jsx)(u.g,{onClick:function(){return o(!0)},disabled:t.is_read_only,Icon:u.i.Share,className:"btn-primary",label:"Partager",title:"Partager ce document avec des personnes"}),!t.is_read_only&&l&&Object(m.jsx)(A,Object(s.a)(Object(s.a)({},e),{},{setOpen:o,isOpen:l}))]})]})},M=function(e){var t=e.docSlug,c=e.doc;return Object(m.jsxs)("div",{className:"document-update-view-actions border-bottom py-1 mb-2",children:[Object(m.jsx)(g.a,Object(s.a)(Object(s.a)({},e),{},{docSlug:t,label:"Supprimer",className:"me-1",onSuccess:function(){return e.history.push("/grio/documents/")}})),Object(m.jsx)(u.g,{Icon:u.i.Archive,onClick:function(n){var s="".concat(Object(o.c)(e.match.url),"view/");if("ARCHIVED"===c.status)return e.history.push(s);p.a.archive(t).then((function(){e.history.push(s)})).catch((function(e){}))},label:"Archiver",title:"Archiver ce document. Un document archiv\xe9 ne peut plus \xeatre modifi\xe9",disabled:c.is_read_only})]})};function R(e){var t,c=e.match.params.docSlug,u=Object(r.useState)(null),d=Object(a.a)(u,2),j=d[0],b=d[1],h=Object(r.useState)(null),O=Object(a.a)(h,2),x=O[0],g=O[1],N=Object(i.c)({title:"",reference:"",description:""}),y=N.setValues;if(Object(r.useEffect)((function(){p.a.get(c).then((function(e){b(e),e.is_read_only||y({title:e.title||"",reference:e.reference||"",description:e.description||""})})).catch((function(e){e.response&&404===e.response.status?g("notfound"):g("error")}))}),[c,y]),x)return Object(m.jsx)("div",{children:Object(m.jsx)("h1",{children:"Ce document n'existe pas"})});if(!j||!j.slug)return null;if(j.is_read_only)return Object(m.jsx)(F.a,{to:"".concat(Object(o.c)(e.match.url),"view/")});var _=function(e){var t=e.name,s=e.value;j&&!j.is_read_only&&p.a.patch(c,Object(n.a)({},t,s),Object(n.a)({},t,j[t])).then((function(e){})).catch((function(e){}))},S=(t={docSlug:c,doc:j,setDoc:b},Object(n.a)(t,"docSlug",c),Object(n.a)(t,"form",N),Object(n.a)(t,"handleTextInputSave",_),t);return Object(m.jsx)(i.b,{context:N,className:"document-update-form",children:Object(m.jsxs)(l.g,{className:"document-update-view miq-container-fluid",children:[Object(m.jsx)(q,Object(s.a)(Object(s.a)({},e),{},{doc:j,setDoc:b,handleTextInputSave:_})),Object(m.jsx)(M,Object(s.a)(Object(s.a)({},e),S)),Object(m.jsx)("div",{className:"border-bottom mb-3",children:Object(m.jsx)(D,Object(s.a)(Object(s.a)({},e),S))}),Object(m.jsxs)("div",{children:[Object(m.jsxs)("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[Object(m.jsx)("h4",{children:"Fichiers"}),Object(m.jsx)("div",{className:"actions",children:Object(m.jsx)(f,{onSuccess:function(e){var t=e.slug;return p.a.patchFile(c,{action:"add",files:[t]}).then((function(e){b(Object(s.a)(Object(s.a)({},j),e))})).catch((function(e){}))},disabled:j.is_read_only,className:"btn-primary-2"})})]}),j.files&&j.files.length>0?Object(m.jsx)(v,{document:j,items:j.files_data,onFileDelete:function(e){var t=e.slug;return b(Object(s.a)(Object(s.a)({},j),{},{files:j.files.filter((function(e){return e!==t})),files_data:j.files_data.filter((function(e){return e.slug!==t}))}))}}):Object(m.jsx)("div",{className:"w-100 text-center py-4",children:"Vous n'avez pas de fichiers ajout\xe9s."})]})]})})}},95:function(e,t,c){"use strict";c.d(t,"b",(function(){return a})),c.d(t,"c",(function(){return r})),c.d(t,"a",(function(){return i}));c(1);var n=c(5),s=c(3),a=function(e){return Object(s.e)(e,{month:"numeric",day:"numeric",year:"numeric"})},r=function(e,t){var c="".concat(t).concat(e.slug,"/");return e.is_read_only?"".concat(c,"view/"):c},i={path:"documents/",list:function(e){return Object(s.h)(n.a,this.path,e)},listPage:function(e){return Object(s.h)(n.a,e)},get:function(e,t){return Object(s.h)(n.a,"".concat(this.path).concat(e,"/"),t)},post:function(e){return n.k.post("".concat(this.path),e)},patch:function(e,t,c){return n.k.patch("".concat(this.path).concat(e,"/"),t,c)},archive:function(e){return n.k.get("".concat(this.path).concat(e,"/archive/"))},delete:function(e){return n.k.delete("".concat(this.path).concat(e,"/"))},patchFile:function(e,t){return Object.keys(t).includes("action")?n.k.post("".concat(this.path).concat(e,"/files/"),t):Promise.reject("Action required")},patchUserPermission:function(e,t,c){return n.k.post("".concat(this.path).concat(e,"/permission/"),{user_slug:t,permission:c})},getStaffList:function(e){return n.k.get("search-staff/",{q:e})},patchUser:function(e,t){return Object.keys(t).includes("action")?n.k.post("".concat(this.path).concat(e,"/users/"),t):Promise.reject("Action required")}}}}]);
//# sourceMappingURL=7.9f94a393.chunk.js.map