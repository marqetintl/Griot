{"version":3,"sources":["../../../../../packages/miq-dmsjs/src/document/DocAddForm.jsx","../../../../../packages/miq-dmsjs/src/document/index.jsx"],"names":["DocumentAddForm","props","form","useForm","title","context","onSubmit","e","preventDefault","values","docServices","post","then","newData","onSuccess","catch","err","handleErr","setError","className","TextInput","required","autoComplete","name","placeholder","error","errors","maxLength","onClick","onCancel","Submit","value","DocumentIndexView","useState","status","setStatus","toasts","useContext","ToastCtx","results","data","setData","isAdding","setAdding","perms","SharedDataCtx","search","location","getDocuments","useCallback","list","push","useRef","debounce","url","history","useEffect","params","URLSearchParams","filter","i","length","message","canAdd","hasPerms","query","actions","labelFirst","Icon","Icons","Plus","label","disabled","newDocument","match","path","slug","style","position","top","initialValue","get","onChange","target","delete","set","current","URL","window","href","pathname","id"],"mappings":"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","file":"static/js/9.faf5be14.chunk.js","sourcesContent":["import Form, { useForm } from '@miq/form';\nimport { Button } from '@miq/components';\n\nimport { docServices } from './utils';\n\nexport default function DocumentAddForm(props) {\n  const form = useForm({ title: '' });\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    const { title } = form.values;\n\n    if (!title) {\n      form.setError('title', 'Entrez le titre du nouveau document');\n      return;\n    }\n\n    docServices\n      .post({ title })\n      .then((newData) => props.onSuccess(newData))\n      .catch((err) => form.handleErr(err, true));\n  };\n\n  return (\n    <Form context={form} onSubmit={handleSubmit} className=\"document-add-form mb-3\">\n      <div className=\"mb-1\">\n        <Form.TextInput\n          required\n          autoComplete=\"off\"\n          name=\"title\"\n          placeholder=\"Entrez le titre du nouveau document\"\n          error={form.errors.title}\n          maxLength={99}\n        />\n      </div>\n\n      <div className=\"d-flex align-items-center justify-content-between\">\n        <div className=\"\">\n          <Button onClick={props.onCancel}>Annuler</Button>\n        </div>\n\n        <div className=\"\">\n          <Form.Submit value=\"Ajouter\" className=\"btn btn-primary\" />\n        </div>\n      </div>\n    </Form>\n  );\n}\n","import { useCallback, useContext, useEffect, useRef, useState } from 'react';\nimport { debounce } from 'lodash';\n\nimport { SharedDataCtx } from '@miq/contexts';\nimport { AdminView, hasPerms } from '@miq/adminjs';\nimport { Icons, IconButton, ToastCtx, SearchTextInput } from '@miq/components';\n\nimport { docServices } from './utils';\nimport DocumentAddForm from './DocAddForm';\nimport DocumentTable from './DocTable';\n\nimport './document.scss';\n\nexport default function DocumentIndexView(props) {\n  const [status, setStatus] = useState('loading');\n  const toasts = useContext(ToastCtx);\n\n  const [data, setData] = useState({ results: [] });\n  const [isAdding, setAdding] = useState(false);\n  const { perms } = useContext(SharedDataCtx);\n\n  const { search } = props.location;\n\n  const getDocuments = useCallback((...params) => docServices.list(...params), []);\n  const push = useRef(debounce((url) => props.history.push(url), 300));\n\n  useEffect(() => {\n    let params = new URLSearchParams(search);\n    if (![...params.values()].filter((i) => i).length) {\n      params = null;\n    }\n\n    getDocuments(params)\n      .then((data) => {\n        if (!data) {\n          setStatus('empty');\n        } else {\n          setStatus('done');\n        }\n\n        setData(data);\n      })\n      .catch((err) => {\n        setStatus('error');\n        toasts.error({ message: 'Something went wrong' });\n      });\n  }, [getDocuments, search]);\n\n  const canAdd = hasPerms(perms.perms, ['miq_dms.add_document']);\n\n  const handleDocumentAdd = (newDocument) => {\n    if (!canAdd) return;\n\n    const url = `${props.match.path}${newDocument.slug}/`;\n    return props.history.push(url);\n  };\n\n  const query = new URLSearchParams(search);\n  const handleSearch = ({ e }) => {\n    const { value } = e.target;\n\n    if (!value || value.length < 3) {\n      query.delete('q');\n    } else {\n      query.set('q', e.target.value);\n    }\n\n    if (!push.current) return;\n\n    const path = new URL(window.location.href);\n    push.current(`${path.pathname}?${query}`);\n  };\n\n  const filterDocuments = (e) => {\n    const { value } = e.target;\n\n    if (!value || value === 'all') {\n      query.delete('filter');\n    } else {\n      query.set('filter', value);\n    }\n\n    if (!push.current) return;\n\n    const path = new URL(window.location.href);\n    push.current(`${path.pathname}?${query}`);\n  };\n\n  return (\n    <AdminView\n      title=\"Documents\"\n      className=\"document-list-view mb-4\"\n      actions={\n        <IconButton\n          labelFirst\n          Icon={Icons.Plus}\n          label=\"Ajouter\"\n          title={canAdd ? 'Ajouter un nouveau document' : 'Vous ne pouvez pas ajouter de nouveau document'}\n          onClick={() => setAdding(!isAdding)}\n          disabled={!canAdd}\n          className=\"btn-primary-2\"\n        />\n      }\n    >\n      <div className=\"miq-container-fluid\">\n        {isAdding && (\n          <div className=\"\">\n            <p className=\"fw-bold mb-2\">Ajouter un nouveau document</p>\n            <DocumentAddForm onSuccess={handleDocumentAdd} onCancel={() => setAdding(false)} />\n          </div>\n        )}\n\n        <div className=\"\">\n          {!isAdding && (\n            <div className=\"py-2\" style={{ position: 'sticky', top: 0 }}>\n              <div className=\"miq-container d-flex mb-3\">\n                <div className=\"flex-1\">\n                  <SearchTextInput initialValue={query.get('q')} onChange={handleSearch} maxLength={99} />\n                </div>\n\n                <select className=\"miq-select ms-1\" value={query.get('filter') || 'all'} onChange={filterDocuments}>\n                  <option value=\"all\">Tous les documents</option>\n                  <option value=\"archived\">Documents archivés</option>\n                  <option value=\"sent\">Documents envoyés</option>\n                  <option value=\"received\">Documents recus</option>\n                </select>\n              </div>\n            </div>\n          )}\n\n          <div id=\"top\" />\n\n          <DocumentTable {...props} {...{ data, setData, status }} />\n        </div>\n      </div>\n    </AdminView>\n  );\n}\n"],"sourceRoot":""}