(this["webpackJsonp@grio/client"]=this["webpackJsonp@grio/client"]||[]).push([[7],{108:function(e,t,c){"use strict";c.r(t),c.d(t,"default",(function(){return I}));var n=c(20),s=c(11),a=c(1),r=c(2),i=c(9),l=c(17),o=c(6),d=c(3),u=c(5),j=(c(167),c(114)),b=c(4),m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:isRequired("file"),t=e.name;if(t.length>=300)return Promise.reject({files:"File name is too long"});var c=new FormData;return c.append("src",e,t),o.l.post("docufiles/",c,{headers:{"content-type":"multipart/form-data"}})},f=function(e,t){return o.l.delete("docufiles/".concat(e,"/?document=").concat(t))},O=c(0),h=["onSuccess"],x=function(e){var t=e.name_truncated;return Object(O.jsxs)("div",{children:[Object(O.jsx)("span",{className:"fw-bold d-block",children:"File Added"}),t]})};function p(e){var t=e.onSuccess,c=Object(b.a)(e,h),n=Object(r.useContext)(u.s),s=Object(r.createRef)();return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(u.h,Object(a.a)(Object(a.a)({Icon:u.j.PaperClip,label:"Joindre",title:"Joindre des fichiers \xe0 ce document"},c),{},{onClick:function(){return s.click()}})),Object(O.jsx)(u.g,{onChange:function(e){Array.from(e.target.files).forEach((function(e){m(e).then((function(e){t&&t(e),n&&n.success({component:Object(O.jsx)(x,Object(a.a)({},e))})})).catch((function(e){n&&n.error({message:"File upload failed.\nPlease try again."})}))}))},ref:function(e){return s=e}})]})}c(142);var g=["document","file"],v=function(e){var t=e.document,c=e.file,n=Object(b.a)(e,g),s=Object(r.useContext)(u.s);if(!t||t.is_read_only)return null;var i=function(){return f(c.slug,t.slug).then((function(e){n.onFileDelete(Object(a.a)(Object(a.a)({},e),{},{slug:c.slug})),s.success({message:"File deleted."})})).catch((function(e){s.error({message:"Something went wrong."})}))};return Object(O.jsx)(u.f,{disabled:t.is_read_only,Icon:u.j.Trash,render:function(){return Object(O.jsx)("div",{className:"p-3",children:"Are you sure?"})},renderHeader:function(){return Object(O.jsxs)("div",{className:"flex-1 fw-bold",children:["Delete file ","".concat(t.title_truncated)]})},renderFooter:function(e){var t=e.setOpen;return Object(O.jsxs)("div",{className:"flex-1",children:[Object(O.jsx)(u.d,{onClick:function(){return t(!1)},className:"me-1",children:"Annuler"}),Object(O.jsx)(u.d,{className:"btn-danger",onClick:i,children:"Delete"})]})}})},N=c(7),S=["items"],_=function(e){switch(e.ext){case".jpg":case".jpeg":case".png":return Object(O.jsx)(u.l,Object(a.a)({},e));default:var t=u.j.getFileIcon(e.ext);return Object(O.jsx)(t,{className:"icon mb-1"})}};function y(e){var t=e.items,c=Object(b.a)(e,S);return Object(N.isArray)(t)?!t.length>0?Object(O.jsx)("div",{className:"w-100 text-center py-4 bg-gray-100 rounded",children:"Ce document n'a pas de fichiers ajout\xe9s."}):Object(O.jsx)("div",{className:"docufile-list border-1 rounded mb-3",style:{overflowX:"scroll"},children:Object(O.jsx)(u.n,{items:t,renderItem:function(e){return Object(O.jsxs)(u.q.Tr,{className:"docufile-list-item border-bottom",children:[Object(O.jsx)(u.q.Td,{children:Object(O.jsx)("a",{href:Object(d.i)(e.src),className:"docufile-btn",target:"_blank",children:Object(O.jsxs)("div",{className:"d-flex",children:[Object(O.jsx)("span",{className:"docufile-icon-wrapper d-none d-md-block me-1",children:_(e)}),Object(O.jsxs)("div",{className:"",children:[Object(O.jsx)("div",{children:e.name_truncated}),Object(O.jsx)("span",{className:"text-sm text-muted",children:e.size})]})]})})}),Object(O.jsx)(u.q.Td,{align:"right",children:Object(O.jsx)("div",{className:"actions",children:Object(O.jsx)(v,Object(a.a)(Object(a.a)({},c),{},{file:e}))})})]},e.slug)},className:"w-100"})}):null}var w=c(19),F=c(30),C=["docSlug"];function k(e){e.docSlug;var t=Object(b.a)(e,C),c=t.form,n=void 0===c?Object(d.l)("form"):c,s=t.document,a=t.handleTextInputSave;return Object(O.jsxs)(l.a,{value:n,children:[Object(O.jsxs)("div",{className:"document-field d-grid grid-lg-12 mb-2",children:[Object(O.jsx)(l.b.Label,{value:"Reference",className:"span-12 mb-1"}),Object(O.jsx)(l.b.TextInput,{name:"reference",onSave:a,autoComplete:"off",className:"span-12 span-md-4",placeholder:"Ajouter une reference ...",disabled:s.is_read_only})]}),Object(O.jsxs)("div",{className:"document-field d-grid grid-1 grid-xl-12 mb-2",children:[Object(O.jsx)(l.b.Label,{value:"Description",className:"span-12 mb-1"}),Object(O.jsx)("div",{className:"span-lg-8",children:Object(O.jsx)(l.b.TextAreaX,{name:"description",onSave:a,placeholder:"Ajouter une description ...",disabled:s.is_read_only})})]})]})}var A=function(e){var t=e.docSlug,c=e.document,n=e.match.path,s="".concat(Object(d.e)(e.match.url),"view/");return Object(O.jsxs)("div",{className:"document-update-view-actions d-flex align-items-center justify-content-between mb-1",children:[Object(O.jsx)("div",{children:Object(O.jsx)(F.c,Object(a.a)(Object(a.a)({},e),{},{docSlug:t,label:"Supprimer",className:"btn-danger-3 me-1",onSuccess:function(){return e.history.push(n.replace(":docSlug/",""))}}))}),Object(O.jsxs)("div",{className:"d-flex",children:[Object(O.jsx)(F.a,Object(a.a)(Object(a.a)({},e),{},{document:c,onSuccess:function(){return location.reload()},className:"btn-primary-2 me-2"})),Object(O.jsx)(F.b,Object(a.a)(Object(a.a)({},e),{},{document:c,onSuccess:function(){return e.history.push(s)},className:"btn-primary-3"}))]})]})};function I(e){var t,c=e.match.params.docSlug,b=Object(r.useState)(null),m=Object(s.a)(b,2),f=m[0],h=m[1],x=Object(r.useState)(null),g=Object(s.a)(x,2),v=g[0],N=g[1],S=Object(r.useContext)(u.s),_=Object(l.c)({title:"",reference:"",description:""}),C=_.setValues;if(Object(r.useEffect)((function(){w.a.detail(c).then((function(e){h(e),e.is_read_only||C({title:e.title||"",reference:e.reference||"",description:e.description||""})})).catch((function(e){e.response&&404===e.response.status?N("notfound"):N("error")}))}),[c,C]),v)return Object(O.jsx)("div",{children:Object(O.jsx)("h1",{children:"Ce document n'existe pas"})});if(!f||!f.slug)return null;if(f.is_read_only)return Object(O.jsx)(i.a,{to:"".concat(Object(d.e)(e.match.url),"view/")});var I=function(e){var t=e.name,s=e.value;if(f&&!f.is_read_only)return w.a.patch(c,Object(n.a)({},t,s),Object(n.a)({},t,f[t])).catch((function(e){}))},T=Object(a.a)(Object(a.a)({},e),{},(t={toast:S,docSlug:c,document:f,setDocument:h},Object(n.a)(t,"docSlug",c),Object(n.a)(t,"form",_),Object(n.a)(t,"handleTextInputSave",I),t));return Object(O.jsx)(l.b,{context:_,className:"document-update-form",children:Object(O.jsxs)(o.g,{className:"document-update-view miq-container-fluid",title:Object(O.jsx)(j.a,{className:"btn-secondary-4"}),actions:Object(O.jsx)(u.i,{to:"".concat(Object(d.e)(e.match.url),"share/"),disabled:f.is_read_only,Icon:u.j.Share,className:"btn-primary",label:"Partager",title:"Partager ce document avec des personnes"}),children:[Object(O.jsx)(A,Object(a.a)({},T)),Object(O.jsx)(o.g.Section,{children:Object(O.jsx)(F.d,{onSave:I})}),Object(O.jsx)(o.g.Section,{className:"mb-3",children:Object(O.jsx)(k,Object(a.a)({},T))}),Object(O.jsx)(o.g.Section,{title:"Fichiers",actions:Object(O.jsx)(p,{onSuccess:function(e){var t=e.slug;return w.a.patchFile(c,{action:"add",files:[t]}).then((function(e){h(Object(a.a)(Object(a.a)({},f),e))})).catch((function(e){}))},disabled:f.is_read_only,className:"btn-primary-2"}),children:Object(O.jsx)(y,{document:f,items:f.files_data,onFileDelete:function(e){var t=e.slug;return h(Object(a.a)(Object(a.a)({},f),{},{files:f.files.filter((function(e){return e!==t})),files_data:f.files_data.filter((function(e){return e.slug!==t}))}))}})})]})})}},114:function(e,t,c){"use strict";c.d(t,"a",(function(){return i}));c(2);var n=c(6),s=c(5),a=c(19),r=c(0),i=function(e){return Object(r.jsx)(n.d,{to:e.to||a.b.staff_path,Icon:s.j.ArrowLeft,title:"Retourner aux documents",className:e.className})}},142:function(e,t,c){},167:function(e,t,c){}}]);
//# sourceMappingURL=7.2bc48bbd.chunk.js.map