{"version":3,"sources":["../../../../../packages/miq-pdfjs/src/index.jsx","../../../../../packages/miq-dmsjs/src/docufile/FileGrid.jsx","../../../../../packages/miq-dmsjs/src/document/ReadOnlyView.jsx","../../../../../packages/miq-dmsjs/src/document/utils.jsx"],"names":["PdfCtx","createContext","PdfViewer","src","children","useState","numPages","setNumPages","pageNumber","setPageNumber","value","useMemo","changePage","offset","prevPageNumber","previousPage","nextPage","Provider","pdfjs","GlobalWorkerOptions","workerSrc","version","Previous","props","useContext","id","className","disabled","onClick","Next","Renderer","getImgUrl","getClassName","file","onLoadSuccess","getIcon","ext","Icon","Icons","getFileIcon","DocuFileGrid","items","map","isImg","fullscreen","title","name","renderHeader","args","setOpen","style","overflowX","name_truncated","renderPreviewHeader","render","minHeight","renderPreview","renderFooter","size","slug","DocumentReadOnlyView","docSlug","match","params","doc","setDoc","setError","useEffect","docServices","get","then","data","catch","err","actions","users_data","user","fontWeight","reference","formatDate","created","month","day","year","description","files_data","UserAvatar","initials","formatDocDate","date","getDocumentLinkTo","document","path","link","is_read_only","list","getService","API","this","listPage","url","post","values","services","patch","oldValues","archive","delete","patchFile","Object","keys","includes","Promise","reject","patchUserPermission","user_slug","permission","getStaffList","q","patchUser"],"mappings":"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","file":"static/js/5.de87d700.chunk.js","sourcesContent":["import { createContext, useContext, useMemo, useState } from \"react\";\n\nimport { Document, Page, pdfjs } from \"react-pdf\";\n\nimport { Button } from \"@miq/components\";\nimport { getClassName, getImgUrl } from \"@miq/utils\";\n\nimport \"./index.scss\";\n\nconst PdfCtx = createContext();\npdfjs.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.js`;\n\nexport default function PdfViewer({ src, children, ...props }) {\n    const [numPages, setNumPages] = useState(null);\n    const [pageNumber, setPageNumber] = useState(1);\n\n    const value = useMemo(() => {\n        function changePage(offset) {\n            setPageNumber((prevPageNumber) => prevPageNumber + offset);\n        }\n\n        function previousPage() {\n            changePage(-1);\n        }\n\n        function nextPage() {\n            changePage(1);\n        }\n\n        return { src, numPages, pageNumber, previousPage, nextPage, setNumPages, setPageNumber };\n    }, [src, numPages, pageNumber]);\n\n    return <PdfCtx.Provider value={value}>{children}</PdfCtx.Provider>;\n}\n\nconst Renderer = (props) => {\n    let { src, pageNumber, setNumPages, setPageNumber } = useContext(PdfCtx);\n\n    if (!src) return null;\n    src = getImgUrl(src);\n\n    function onDocumentLoadSuccess({ numPages }) {\n        setNumPages(numPages);\n        setPageNumber(pageNumber);\n    }\n\n    return (\n        <div id={props.id} className={getClassName([\"miq-pdf\", props.className])}>\n            <Document file={src} onLoadSuccess={onDocumentLoadSuccess}>\n                <Page pageNumber={pageNumber} />\n            </Document>\n        </div>\n    );\n};\n\nconst Previous = (props) => {\n    const { pageNumber, previousPage } = useContext(PdfCtx);\n\n    return (\n        <Button id={props.id} className={props.className} disabled={pageNumber <= 1} onClick={previousPage}>\n            Previous\n        </Button>\n    );\n};\n\nconst Next = (props) => {\n    const { pageNumber, numPages, nextPage } = useContext(PdfCtx);\n\n    return (\n        <Button id={props.id} className={props.className} disabled={pageNumber >= numPages} onClick={nextPage}>\n            Next\n        </Button>\n    );\n};\n\nPdfViewer.Previous = Previous;\nPdfViewer.Next = Next;\nPdfViewer.Renderer = Renderer;\n\n// {numPages &&\n// Array(numPages)\n//     .fill()\n//     .map((_, i) => <Page pageNumber={i + 1} />)}\n","import { Icons, Button, ImgSquare, Img, ConfirmIconButton } from \"@miq/components\";\nimport PdfViewer from \"@miq/pdfjs\";\n\nimport \"./docufile-grid.scss\";\n\nconst getIcon = (file) => {\n    switch (file.ext) {\n        case \".jpg\":\n        case \".jpeg\":\n        case \".png\":\n            return <ImgSquare {...file} />;\n\n        default:\n            const Icon = Icons.getFileIcon(file.ext);\n            return <Icon className=\"icon mb-1\" />;\n    }\n};\n\nexport default function DocuFileGrid({ items = [], ...props }) {\n    const renderPreview = ({ file, isImg }) => {\n        return (\n            <div className=\"miq-container\" style={{ minHeight: 500 }}>\n                {isImg && <Img {...file} />}\n                {file.ext === \".pdf\" && <PdfViewer.Renderer />}\n            </div>\n        );\n    };\n\n    const renderPreviewHeader = ({ setOpen, file }) => (\n        <div className=\"flex-1 d-flex justify-content-between\">\n            <div className=\"\" style={{ overflowX: \"scroll\" }}>\n                {file.name_truncated}\n            </div>\n\n            <div className=\"flex-1\">\n                <Button className=\"me-1\">Delete</Button>\n                <Button onClick={() => setOpen(false)}>Close</Button>\n            </div>\n        </div>\n    );\n\n    const renderPreviewFooter = ({ file }) => {\n        if (file.ext !== \".pdf\") return null;\n\n        return (\n            <div className=\"flex-1 miq-container d-flex align-items-center justify-content-between\">\n                <div>\n                    <PdfViewer.Previous />\n                </div>\n                <div>\n                    <PdfViewer.Next />\n                </div>\n            </div>\n        );\n    };\n    return (\n        <div className=\"docufile-grid d-grid grid-2 grid-sm-3 grid-md-4 grid-xl-5\">\n            {items.map((file) => {\n                const isImg = file.ext === \".jpg\" || file.ext === \".jpeg\" || file.ext === \".png\";\n\n                return (\n                    <PdfViewer src={file.src} key={file.slug}>\n                        <ConfirmIconButton\n                            fullscreen\n                            title={file.name}\n                            className=\"docufile-btn\"\n                            renderHeader={(args) => renderPreviewHeader({ ...args, file })}\n                            render={(args) => renderPreview({ ...args, file, isImg })}\n                            renderFooter={(args) => renderPreviewFooter({ ...args, file })}\n                        >\n                            {getIcon(file)}\n\n                            <div className=\"text-center\">\n                                <span className=\"label d-block\">{file.name_truncated}</span>\n                                <span className=\"size d-block\">{file.size}</span>\n                            </div>\n                        </ConfirmIconButton>\n                    </PdfViewer>\n                );\n            })}\n        </div>\n    );\n}\n","import { AdminView } from \"@miq/adminjs\";\nimport { useEffect, useState } from \"react\";\n\nimport { formatDate } from \"@miq/utils\";\n\nimport DocuFileGrid from \"../docufile/FileGrid\";\nimport { docServices } from \"./utils\";\n\nexport default function DocumentReadOnlyView(props) {\n    const { docSlug } = props.match.params;\n\n    const [doc, setDoc] = useState(null);\n    const [error, setError] = useState(null);\n\n    useEffect(() => {\n        docServices\n            .get(docSlug)\n            .then((data) => {\n                setDoc(data);\n            })\n            .catch((err) => setError(\"Error\"));\n    }, []);\n\n    if (!doc) return null;\n\n    return (\n        <AdminView\n            id=\"DocumentReadOnlyView\"\n            className=\"document-readonly-view\"\n            title={doc.title}\n            actions={\n                <>\n                    <div className=\"miq-user-avatar-group\">\n                        <div className=\"miq-user-avatar count\">+6</div>\n\n                        {doc.users_data.map((user) => (\n                            <UserAvatar user={user} key={user.slug} />\n                        ))}\n                    </div>\n                </>\n            }\n        >\n            <div className=\"d-flex justify-content-between mb-2\">\n                <div className=\"\">\n                    Reference <span style={{ fontWeight: \"600\" }}>{doc.reference}</span>\n                </div>\n\n                <div className=\"text-muted fs-sm\">\n                    {formatDate(doc.created, { month: \"long\", day: \"numeric\", year: \"numeric\" }, \"fr\")}\n                </div>\n            </div>\n\n            <div className=\"mb-4\">{doc.description}</div>\n\n            {/*  */}\n            <DocuFileGrid items={doc.files_data} />\n\n            <div className=\"\">Voir les commentaires</div>\n        </AdminView>\n    );\n}\n\nconst UserAvatar = ({ user, ...props }) => {\n    if (!user) return null;\n    return <div className=\"miq-user-avatar\">{user.initials}</div>;\n};\n","import { API, services } from \"@miq/adminjs\";\nimport { getService } from \"@miq/utils\";\nimport { addOrUpdateArrayObject } from \"@miq/utils\";\nimport { formatDate } from \"@miq/utils\";\n\nexport const formatDocDate = (date) => formatDate(date, { month: \"numeric\", day: \"numeric\", year: \"numeric\" });\n\nexport const getDocumentLinkTo = (document, path) => {\n    const link = `${path}${document.slug}/`;\n    if (document.is_read_only) {\n        return `${link}view/`;\n    }\n    return link;\n};\n\nexport const docServices = {\n    path: \"documents/\",\n\n    /**\n     * DOCUMENT\n     */\n\n    list(params) {\n        return getService(API, this.path, params);\n    },\n    listPage(url) {\n        return getService(API, url);\n    },\n    get(docSlug, params) {\n        return getService(API, `${this.path}${docSlug}/`, params);\n    },\n    post(values) {\n        return services.post(`${this.path}`, values);\n    },\n    patch(docSlug, values, oldValues) {\n        return services.patch(`${this.path}${docSlug}/`, values, oldValues);\n    },\n    archive(docSlug) {\n        return services.get(`${this.path}${docSlug}/archive/`);\n    },\n    delete(docSlug) {\n        return services.delete(`${this.path}${docSlug}/`);\n    },\n\n    /**\n     * Add a docufile to a document\n     * @param {*} docSlug\n     * @param {*} values\n     * @returns\n     */\n\n    patchFile(docSlug, values) {\n        if (!Object.keys(values).includes(\"action\")) {\n            return Promise.reject(\"Action required\");\n        }\n\n        return services.post(`${this.path}${docSlug}/files/`, values);\n    },\n\n    /**\n     * USER\n     */\n\n    patchUserPermission(docSlug, user_slug, permission) {\n        return services.post(`${this.path}${docSlug}/permission/`, { user_slug, permission });\n    },\n\n    getStaffList(q) {\n        return services.get(\"search-staff/\", { q });\n    },\n\n    patchUser(docSlug, values) {\n        if (!Object.keys(values).includes(\"action\")) {\n            return Promise.reject(\"Action required\");\n        }\n\n        return services.post(`${this.path}${docSlug}/users/`, values);\n    },\n};\n\nexport const docsReducer = (state = { results: [] }, action) => {\n    const { type, payload = {} } = action;\n    let results;\n\n    switch (type) {\n        case \"SET_DOCS\":\n            return { ...payload };\n\n        case \"APPEND_DOC\":\n            results = addOrUpdateArrayObject(state.results, payload, \"slug\", true);\n            return { ...state, results };\n\n        case \"ADD_UPDATE_DOC\":\n        case \"PREPEND_DOC\":\n            results = addOrUpdateArrayObject(state.results, payload);\n            return { ...state, results };\n\n        case \"REMOVE_DOC\":\n            results = state.results.filter(({ slug }) => slug !== payload.slug);\n            return { ...state, results };\n\n        default:\n            return { ...state };\n    }\n};\n"],"sourceRoot":""}