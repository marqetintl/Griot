(this["webpackJsonp@grio/client"]=this["webpackJsonp@grio/client"]||[]).push([[8],{107:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return h}));var n=s(4),c=s(1),a=s(11),r=s(2),u=s(7),i=s(17),l=s(6),o=s(5),d=(s(166),s(19)),j=s(114),m=s(0),b=["user","document"];function h(e){var t=e.match.params.docSlug,s=Object(r.useContext)(o.s),n=Object(r.useState)(""),b=Object(a.a)(n,2),h=b[0],O=b[1],g=Object(r.useState)([]),p=Object(a.a)(g,2),x=p[0],v=p[1],N=Object(r.useState)({users_data:[],users:[]}),w=Object(a.a)(N,2),S=w[0],C=w[1],y=Object(i.c)({user:null});Object(r.useEffect)((function(){d.a.detail(t).then((function(e){C(e)})).catch((function(e){}))}),[t]);var _=Object(r.useCallback)(Object(u.debounce)((function(e){return d.a.getStaffList(e).then((function(e){var t=e.results;v(t)}))}),400),[]);if(Object(r.useEffect)((function(){!h||h.length<3||_(h)}),[h,_]),!S||!S.slug)return null;var k=function(e){O((function(){return""}))},D=x.filter((function(e){return!S.users.includes(e.slug)}));return Object(m.jsx)(i.b,{context:y,id:"DocumentShareModal",children:Object(m.jsxs)(l.g,{title:Object(m.jsxs)("div",{className:"d-flex align-items-center",children:[Object(m.jsx)(j.a,{to:e.match.url.replace("share/",""),className:"btn-secondary-4 me-1"}),Object(m.jsx)("h2",{className:"text-md",children:"Partager avec des personnes"})]}),className:"document-share-view",children:[Object(m.jsx)("div",{className:"select-user-form mb-3",children:Object(m.jsx)(o.e,{floating:!0,header:Object(m.jsx)("input",{required:!0,name:"q",value:h,onChange:function(e){return O(e.target.value)},placeholder:"Username, name or email",className:"miq-input"}),isOpen:h.length>2&&D.length>0,children:Object(m.jsxs)("div",{className:"border-1 rounded",children:[D.map((function(e,n){return Object(m.jsxs)("div",{className:"user-card-wrapper",onClick:function(){return function(e){S.users.includes(e.slug)||y.setValue("user",e)}(e)},role:"button",title:"Partager le document avec ".concat(e.name),children:[Object(m.jsx)(o.u,{user:e}),Object(m.jsx)(o.d,{onClick:function(){return function(e){var n=e.slug,a=e.name;n&&n!==S.uploaded_by.slug&&d.a.patchUser(t,{action:"add",users:[n]}).then((function(e){s.success({message:"Document shared with ".concat(a)}),C(Object(c.a)(Object(c.a)({},S),e)),k()})).catch((function(e){s.error({message:"Something went wrong.\n Please try again."})}))}(e)},className:"btn-primary-3",children:"Ajouter"})]},"".concat(e.slug,"-").concat(n))})),Object(m.jsx)("div",{className:"p-1",children:Object(m.jsx)(o.d,{onClick:k,children:"Annuler"})})]})})}),Object(m.jsxs)("div",{className:"shared-users miq-container pb-3",children:[Object(m.jsxs)("p",{className:"pb-2",children:["Le document ",Object(m.jsx)("span",{className:"fw-bold",children:S.title})," est actuellement partag\xe9 avec:"]}),Object(m.jsxs)("div",{className:"shared-user",children:[Object(m.jsx)(o.u,{user:S.uploaded_by}),Object(m.jsx)("span",{className:"text-muted",children:"Owner"})]}),S.users_data.map((function(e){return Object(m.jsx)(f,{user:e,document:S,setDocument:C,toast:s},e.slug)}))]})]})})}var f=function(e){var t=e.user,s=e.document,u=Object(n.a)(e,b),i=u.toast,l=Object(r.useState)(t.permission||"VIEW"),j=Object(a.a)(l,2),h=j[0],f=j[1];if(!t||!s)return null;var O=function(e){u.setDocument&&u.setDocument(Object(c.a)(Object(c.a)({},s),e))},g=Object.values(s.permissions);return console.log(s),Object(m.jsxs)("div",{className:"shared-user",children:[Object(m.jsx)(o.u,{user:t}),s.can_change_share_permission&&Object(m.jsxs)("div",{className:"d-flex align-items-center",children:[Object(m.jsx)("select",{value:h,className:"miq-select p-1 me-2",onChange:function(e){var n=e.target.value;e.preventDefault(),d.a.patchUserPermission(s.slug,t.slug,n).then((function(e){f(n),i.success({message:"Permission updated."}),O(e)})).catch((function(e){i.error({message:"Something went wrong.\n Please try again."})}))},title:"Changer la permission",children:g.map((function(e){return Object(m.jsx)("option",{value:e.value,children:e.label},e.name)}))}),Object(m.jsx)(o.h,{onClick:function(e){d.a.patchUser(s.slug,{action:"remove",users:[t.slug]}).then((function(e){i.success({message:"Document users updated."}),O(e)})).catch((function(e){i.error({message:"Something went wrong.\n Please try again."})}))},Icon:o.j.Trash,className:"btn-secondary-4",title:"Supprimer ".concat(t.name)})]})]},t.slug)}},114:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));s(2);var n=s(6),c=s(5),a=s(19),r=s(0),u=function(e){return Object(r.jsx)(n.d,{to:e.to||a.b.staff_path,Icon:c.j.ArrowLeft,title:"Retourner aux documents",className:e.className})}},166:function(e,t,s){}}]);
//# sourceMappingURL=8.c7eed9fd.chunk.js.map